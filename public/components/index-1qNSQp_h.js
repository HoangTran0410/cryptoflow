const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./walletcard-RAhMRSiJ.js","../vendor-Bvlc0P6K.js","../index-BJE6JHDp.js","../index-Bs_JqdHU.css","./connectionpanel-A51UpndI.js","./connectionrenderer-DkUKtMkS.js","./walletpanel-B_spx2CB.js"])))=>i.map(i=>d[i]);
import{_ as z,L as T}from"../index-BJE6JHDp.js";import{r,t as X,u as Ee,v as de,j as t,w as ue,S as Ae,P as Re,Z as _e,x as Ie,M as Pe,y as We,z as De,G as Le,D as Xe,E as ze,n as Y}from"../vendor-Bvlc0P6K.js";const Te=Y(()=>z(()=>import("./walletcard-RAhMRSiJ.js"),__vite__mapDeps([0,1,2,3]),import.meta.url),{fallback:T}),Ye=Y(()=>z(()=>import("./connectionpanel-A51UpndI.js"),__vite__mapDeps([4,1,2,3]),import.meta.url),{fallback:T}),$e=Y(()=>z(()=>import("./connectionrenderer-DkUKtMkS.js"),__vite__mapDeps([5,1,2,3]),import.meta.url),{fallback:T}),Oe=Y(()=>z(()=>import("./walletpanel-B_spx2CB.js"),__vite__mapDeps([6,1,2,3]),import.meta.url),{fallback:T}),h=250,Q=80,Be=20,me=180,Ze=({transactions:g})=>{var re,ae;const[a,E]=r.useState([]),[m,N]=r.useState(null),[p,$]=r.useState(null),[w,O]=r.useState(""),[b,xe]=r.useState({x:0,y:0,k:1}),[A,B]=r.useState("curve"),[y,J]=r.useState(null),G=r.useRef({x:0,y:0}),U=r.useRef({laneIndex:0,yPosition:0}),[R,he]=r.useState(400),[_,K]=r.useState(!1),V=r.useRef({x:0,width:400}),u=r.useRef(null),M=r.useRef(null),v=r.useRef(null),ee=r.useMemo(()=>{const e=new Map;return g.forEach(s=>{const n=e.get(s.from)||{inflow:0,outflow:0,txCount:0};n.outflow+=s.amount,n.txCount++,e.set(s.from,n);const o=e.get(s.to)||{inflow:0,outflow:0,txCount:0};o.inflow+=s.amount,o.txCount++,e.set(s.to,o)}),e},[g]),Z=r.useMemo(()=>{const e=new Set;return g.forEach(s=>{e.add(s.from),e.add(s.to)}),Array.from(e)},[g]),fe=r.useMemo(()=>{const e=new Set(a.map(n=>n.address)),s=new Map;return g.forEach(n=>{if(e.has(n.from)&&e.has(n.to)){const o=`${n.from}->${n.to}`,l=s.get(o)||{fromAddress:n.from,toAddress:n.to,totalAmount:0,txCount:0,transactions:[]};l.totalAmount+=n.amount,l.txCount++,l.transactions.push(n),s.set(o,l)}}),Array.from(s.values())},[a,g]),k=r.useMemo(()=>{const e=new Map;return a.forEach(s=>{const n=s.laneIndex*h+h/2,o=s.yPosition;e.set(s.address,{x:n,y:o,leftEdge:n-me/2,rightEdge:n+me/2})}),e},[a]),j=r.useMemo(()=>{if(a.length===0)return{minX:-2,maxX:5,minY:-500,maxY:1500};const e=a.map(x=>x.laneIndex),s=a.map(x=>x.yPosition),n=Math.min(...e),o=Math.max(...e),l=Math.min(...s),c=Math.max(...s);return{minX:Math.min(-2,n-2),maxX:Math.max(5,o+3),minY:Math.min(-500,l-500),maxY:Math.max(1500,c+500)}},[a]);r.useEffect(()=>{if(!u.current||!M.current)return;const e=X(u.current),s=Ee().scaleExtent([.1,4]).filter(o=>{var l;if(o.type==="wheel")return!0;if(o.type==="mousedown"){let c=o.target;for(;c&&c!==u.current;){if((l=c.classList)!=null&&l.contains("wallet-card"))return!1;c=c.parentElement}}return!o.button}).on("zoom",o=>{xe({x:o.transform.x,y:o.transform.y,k:o.transform.k})});e.call(s),v.current=s;const n=de.translate(100,200).scale(1);return e.call(s.transform,n),()=>{e.on(".zoom",null)}},[]);const F=r.useCallback((e,s,n)=>{if(a.some(d=>d.address===e))return;const o=ee.get(e)||{inflow:0,outflow:0,txCount:0};let l=0;s!==void 0&&(l=n?s-1:s+1);const c=a.filter(d=>d.laneIndex===l),x=c.length>0?Math.max(...c.map(d=>d.yPosition))+Q+Be:100,f={address:e,laneIndex:l,yPosition:x,totalInflow:o.inflow,totalOutflow:o.outflow,txCount:o.txCount};E(d=>[...d,f]),O("")},[a,ee]),ge=r.useCallback(e=>{E(s=>s.filter(n=>n.address!==e)),m===e&&N(null)},[m]),pe=e=>{e.preventDefault(),w.trim()&&Z.includes(w.trim())&&F(w.trim())},we=r.useCallback((e,s)=>{e.stopPropagation(),e.preventDefault();const n=a.find(o=>o.address===s);n&&(J(s),G.current={x:e.clientX,y:e.clientY},U.current={laneIndex:n.laneIndex,yPosition:n.yPosition})},[a]),be=r.useCallback(e=>{if(!y)return;const s=(e.clientX-G.current.x)/b.k,n=(e.clientY-G.current.y)/b.k,l=U.current.laneIndex*h+h/2+s,c=Math.round((l-h/2)/h),x=U.current.yPosition+n;E(f=>f.map(d=>d.address===y?{...d,laneIndex:c,yPosition:x}:d))},[y,b.k]),te=r.useCallback(()=>{y&&J(null)},[y]),ye=()=>{u.current&&v.current&&X(u.current).transition().duration(300).call(v.current.scaleBy,1.3)},ve=()=>{u.current&&v.current&&X(u.current).transition().duration(300).call(v.current.scaleBy,.7)},je=()=>{if(!u.current||!M.current||!v.current||a.length===0)return;const e=M.current.clientWidth,s=M.current.clientHeight,o=a.map(i=>i.address).map(i=>k.get(i)).filter(Boolean);if(o.length===0)return;const l=100,c=Math.min(...o.map(i=>i.leftEdge))-l,x=Math.max(...o.map(i=>i.rightEdge))+l,f=Math.min(...o.map(i=>i.y))-l,d=Math.max(...o.map(i=>i.y))+Q+l,I=x-c,P=d-f,W=e/I,le=s/P,H=Math.min(W,le,1.5),q=(c+x)/2,D=(f+d)/2,C=de.translate(e/2,s/2).scale(H).translate(-q,-D);X(u.current).transition().duration(500).call(v.current.transform,C)},Ce=r.useCallback(()=>{if(!(!u.current||a.length===0))try{const e=u.current.cloneNode(!0),s=(i,ie)=>{const Me=window.getComputedStyle(i),ke=ie;["width","height","fill","stroke","stroke-width","opacity","font-size","font-family","font-weight"].forEach(L=>{const S=Me.getPropertyValue(L);S&&S!=="none"&&S!=="auto"&&ke.style.setProperty(L,S)}),Array.from(i.children).forEach((L,S)=>{const ce=ie.children[S];ce&&s(L,ce)})};u.current&&s(u.current,e);const o=a.map(i=>i.address).map(i=>k.get(i)).filter(Boolean);if(o.length===0)return;const l=100,c=Math.min(...o.map(i=>i.leftEdge))-l,x=Math.max(...o.map(i=>i.rightEdge))+l,f=Math.min(...o.map(i=>i.y))-l,d=Math.max(...o.map(i=>i.y))+Q+l,I=x-c,P=d-f;e.setAttribute("viewBox",`${c} ${f} ${I} ${P}`),e.setAttribute("width",I.toString()),e.setAttribute("height",P.toString());const W=e.querySelector("g");W&&W.removeAttribute("transform");const H=new XMLSerializer().serializeToString(e),q=new Blob([H],{type:"image/svg+xml"}),D=URL.createObjectURL(q),C=document.createElement("a");C.href=D,C.download=`arkham-tracer-${Date.now()}.svg`,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(D)}catch(e){console.error("Export error:",e),alert("Failed to export graph. Please try again.")}},[a,k]),se=r.useMemo(()=>{if(!w.trim())return[];const e=w.toLowerCase();return Z.filter(s=>s.toLowerCase().includes(e)&&!a.some(n=>n.address===s)).slice(0,5)},[w,Z,a]),Se=r.useMemo(()=>new Set(a.map(e=>e.address)),[a]),Ne=r.useMemo(()=>{var e;if(m)return(e=a.find(s=>s.address===m))==null?void 0:e.laneIndex},[m,a]),ne=r.useMemo(()=>m&&a.find(e=>e.address===m)||null,[m,a]),oe=r.useCallback(e=>{e.preventDefault(),K(!0),V.current={x:e.clientX,width:R}},[R]);return r.useEffect(()=>{if(!_)return;const e=n=>{const o=V.current.x-n.clientX,l=Math.min(800,Math.max(300,V.current.width+o));he(l)},s=()=>{K(!1)};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",s),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",s)}},[_]),t.jsxs("div",{className:"flex flex-col h-[calc(100vh-50px)] gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg flex items-center justify-center shadow-lg shadow-amber-500/20",children:t.jsx(ue,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"Arkham Tracer"}),t.jsx("p",{className:"text-slate-400 text-sm",children:"Trace wallet connections and transaction flows"})]})]}),t.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-xl border border-slate-800 flex flex-wrap items-center gap-4 shrink-0",children:[t.jsxs("form",{onSubmit:pe,className:"relative flex-1 max-w-md",children:[t.jsx("input",{type:"text",placeholder:"Search wallet address...",value:w,onChange:e=>O(e.target.value),className:"w-full bg-slate-950 border border-slate-700 text-slate-200 pl-10 pr-4 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500/50"}),t.jsx(Ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),se.length>0&&t.jsx("div",{className:"absolute top-full mt-1 left-0 right-0 bg-slate-900 border border-slate-700 rounded-lg shadow-xl z-50 overflow-hidden",children:se.map(e=>t.jsxs("button",{type:"button",onClick:()=>{F(e),O("")},className:"w-full px-4 py-2 text-left text-sm text-slate-200 hover:bg-slate-800 flex items-center gap-2",children:[t.jsx(Re,{className:"w-4 h-4 text-indigo-400"}),t.jsx("span",{className:"font-mono truncate",children:e})]},e))})]}),t.jsxs("div",{className:"flex items-center gap-1 border-l border-slate-800 pl-4",children:[t.jsx("button",{onClick:ve,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg",title:"Zoom Out",children:t.jsx(_e,{className:"w-4 h-4"})}),t.jsx("button",{onClick:ye,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg",title:"Zoom In",children:t.jsx(Ie,{className:"w-4 h-4"})}),t.jsx("button",{onClick:je,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg",title:"Fit View",children:t.jsx(Pe,{className:"w-4 h-4"})})]}),t.jsx("div",{className:"flex items-center gap-1 border-l border-slate-800 pl-4",children:t.jsxs("div",{className:"flex gap-1 bg-slate-950 rounded-lg p-1 border border-slate-700",children:[t.jsx("button",{onClick:()=>B("curve"),className:`p-2 rounded transition-colors ${A==="curve"?"bg-indigo-600 text-white":"text-slate-400 hover:text-slate-200"}`,title:"Curved connections",children:t.jsx(We,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>B("straight"),className:`p-2 rounded transition-colors ${A==="straight"?"bg-indigo-600 text-white":"text-slate-400 hover:text-slate-200"}`,title:"Straight line connections",children:t.jsx(De,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>B("step"),className:`p-2 rounded transition-colors ${A==="step"?"bg-indigo-600 text-white":"text-slate-400 hover:text-slate-200"}`,title:"Step/elbow connections",children:t.jsx(Le,{className:"w-4 h-4"})})]})}),a.length>0&&t.jsxs("button",{onClick:Ce,className:"flex items-center gap-2 px-3 py-2 text-sm text-slate-300 hover:bg-slate-800 rounded-lg border border-slate-700",title:"Export graph as SVG image",children:[t.jsx(Xe,{className:"w-4 h-4"}),"Export SVG"]}),a.length>0&&t.jsxs("button",{onClick:()=>{E([]),N(null)},className:"flex items-center gap-2 px-3 py-2 text-sm text-red-400 hover:bg-red-500/10 rounded-lg border border-red-500/30",children:[t.jsx(ze,{className:"w-4 h-4"}),"Clear All"]})]}),t.jsxs("div",{className:"flex-1 flex gap-1 min-h-0",children:[t.jsxs("div",{ref:M,className:`${m?"flex-1":"w-full"} bg-slate-950 rounded-xl border border-slate-800 overflow-hidden relative`,onMouseMove:be,onMouseUp:te,onMouseLeave:te,children:[t.jsxs("svg",{ref:u,className:"w-full h-full",style:{cursor:y?"grabbing":"grab"},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"laneGradient",x1:"0",y1:j.minY,x2:"0",y2:j.maxY,gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0%",stopColor:"#475569",stopOpacity:"0"}),t.jsx("stop",{offset:"20%",stopColor:"#475569",stopOpacity:"0.4"}),t.jsx("stop",{offset:"50%",stopColor:"#475569",stopOpacity:"0.6"}),t.jsx("stop",{offset:"80%",stopColor:"#475569",stopOpacity:"0.4"}),t.jsx("stop",{offset:"100%",stopColor:"#475569",stopOpacity:"0"})]})}),t.jsxs("g",{transform:`translate(${b.x}, ${b.y}) scale(${b.k})`,children:[Array.from({length:j.maxX-j.minX}).map((e,s)=>{const n=j.minX+s;return t.jsx("line",{x1:n*h+h/2,y1:j.minY,x2:n*h+h/2,y2:j.maxY,stroke:"url(#laneGradient)",strokeWidth:2,strokeDasharray:"8 4"},`lane-${n}`)}),t.jsx($e,{connections:fe,walletPositions:k,transform:b,connectionStyle:A,selectedConnection:p?{from:((re=p.aToB)==null?void 0:re.fromAddress)||p.addressA,to:((ae=p.aToB)==null?void 0:ae.toAddress)||p.addressB}:null,onConnectionClick:e=>{$(e),N(null)}}),a.map(e=>{const s=k.get(e.address);return s?t.jsx(Te,{wallet:e,isSelected:m===e.address,isDragging:y===e.address,position:s,onSelect:()=>{N(e.address),$(null)},onDragStart:n=>we(n,e.address)},e.address):null})]})]}),a.length===0&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(ue,{className:"w-8 h-8 text-slate-600"})}),t.jsx("p",{className:"text-slate-400 text-lg mb-2",children:"No wallets added yet"}),t.jsx("p",{className:"text-slate-500 text-sm",children:"Search for a wallet address above to start tracing"})]})})]}),m&&ne&&t.jsxs(t.Fragment,{children:[t.jsx("div",{onMouseDown:oe,className:`w-2 flex-shrink-0 cursor-col-resize group flex items-center justify-center hover:bg-indigo-500/20 transition-colors rounded ${_?"bg-indigo-500/30":""}`,children:t.jsx("div",{className:"w-1 h-16 bg-slate-700 group-hover:bg-indigo-500 transition-colors rounded"})}),t.jsx("div",{style:{width:R},className:"shrink-0",children:t.jsx(Oe,{selectedWallet:m,wallet:ne,transactions:g,onClose:()=>N(null),onRemoveWallet:ge,onAddWallet:F,existingWalletSet:Se,selectedWalletLane:Ne})})]}),p&&t.jsxs(t.Fragment,{children:[t.jsx("div",{onMouseDown:oe,className:`w-2 flex-shrink-0 cursor-col-resize group flex items-center justify-center hover:bg-indigo-500/20 transition-colors rounded ${_?"bg-indigo-500/30":""}`,children:t.jsx("div",{className:"w-1 h-16 bg-slate-700 group-hover:bg-indigo-500 transition-colors rounded"})}),t.jsx("div",{style:{width:R},className:"shrink-0",children:t.jsx(Ye,{connection:p,onClose:()=>$(null)})})]})]})]})};export{Ze as default};
