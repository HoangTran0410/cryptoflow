import{r as i,t as G,v as Q,u as me,ai as fe,aj as he,ak as pe,al as ge,am as be,j as e,N as ve,p as je,M as we,g as ye,f as Ne,an as ke,ao as Se,e as Ce,S as Me,c as U}from"../vendor-DWEmHMvc.js";import Ee from"./transactiontable-Di6tvRna.js";import"../index-CodYiM9M.js";const J=(g,O=300)=>{const x=new Map,f=new Map,h=new Map;g.forEach(n=>{h.set(n.from,(h.get(n.from)||0)+n.amount),h.set(n.to,(h.get(n.to)||0)+n.amount)});const C=new Set(Array.from(h.entries()).sort((n,j)=>j[1]-n[1]).slice(0,O===0?void 0:O).map(n=>n[0]));return g.forEach(n=>{if(!C.has(n.from)||!C.has(n.to))return;x.has(n.from)||x.set(n.from,{id:n.from,val:0,type:"source",transactionCount:0}),x.has(n.to)||x.set(n.to,{id:n.to,val:0,type:"target",transactionCount:0});const j=x.get(n.from),w=x.get(n.to);j.val+=n.amount,w.val+=n.amount,j.transactionCount=(j.transactionCount||0)+1,w.transactionCount=(w.transactionCount||0)+1;const M=`${n.from}-${n.to}`;if(f.has(M)){const o=f.get(M);o.value+=n.amount,o.count=(o.count||0)+1}else f.set(M,{source:n.from,target:n.to,value:n.amount,count:1})}),{nodes:Array.from(x.values()),links:Array.from(f.values())}},Ae=({transactions:g,initialAddress:O})=>{const x=i.useRef(null),f=i.useRef(null),h=i.useRef(null),C=i.useRef(null),[n,j]=i.useState([]),[w,M]=i.useState([]),[o,I]=i.useState(null),[L,K]=i.useState(""),[b,V]=i.useState(null),Z=i.useMemo(()=>b?g.filter(t=>t.from===b.source&&t.to===b.target||t.from===b.target&&t.to===b.source):[],[b,g]),[_,z]=i.useState(!1),[u,H]=i.useState({start:"",end:""}),[W,ee]=i.useState(0),[X,te]=i.useState(""),[$,se]=i.useState("");i.useEffect(()=>{g.length>0&&u.start},[g]);const A=i.useMemo(()=>{let t=g;if(u.start||u.end){const a=u.start?new Date(u.start).getTime():0,l=u.end?new Date(u.end).getTime():1/0;t=t.filter(s=>{const c=s.date.getTime();return c>=a&&c<=l})}return t},[g,u]);i.useEffect(()=>{const t=J(A,0);let a=t.nodes;if(X||$){const l=parseFloat(X)||0,s=parseFloat($)||0,c=new Map;t.links.forEach(d=>{const v=d.source,S=d.target;c.has(v)||c.set(v,{in:0,out:0}),c.has(S)||c.set(S,{in:0,out:0}),c.get(v).out+=d.value,c.get(S).in+=d.value}),a=a.filter(d=>{const v=c.get(d.id)||{in:0,out:0};return v.in>=l&&v.out>=s});const m=new Set(a.map(d=>d.id));t.links=t.links.filter(d=>m.has(d.source)&&m.has(d.target)),t.nodes=a}j(t.nodes),M(t.links)},[A,X,$]);const k=i.useMemo(()=>{if(!o)return null;let t=0,a=0,l=0;return A.forEach(s=>{s.to===o&&(t+=s.amount,l++),s.from===o&&(a+=s.amount,l++)}),{id:o,inflow:t,outflow:a,net:t-a,count:l}},[o,A]),T=i.useMemo(()=>{const t=new Set;return o&&(t.add(o),w.forEach(a=>{const l=typeof a.source=="object"?a.source.id:a.source,s=typeof a.target=="object"?a.target.id:a.target;l===o&&t.add(s),s===o&&t.add(l)})),t},[o,w]),ae=(t,a)=>{a.stopPropagation(),o!==t.id&&I(t.id)},re=()=>{I(null)},ne=t=>{if(t.preventDefault(),!L)return;n.some(l=>l.id===L)&&(I(L),setTimeout(()=>{var s,c;const l=n.find(m=>m.id===L);if(l&&l.x&&l.y&&x.current&&h.current){const m=((s=f.current)==null?void 0:s.clientWidth)||800,d=((c=f.current)==null?void 0:c.clientHeight)||800;G(x.current).transition().duration(750).call(h.current.transform,Q.translate(m/2,d/2).scale(1.5).translate(-l.x,-l.y))}},300))},oe=i.useCallback((t,a)=>{V({source:t,target:a})},[]),le=()=>{const t=J(A,0);j(t.nodes),M(t.links),I(null),setTimeout(B,300)},B=i.useCallback(()=>{if(!x.current||!f.current||!h.current||n.length===0)return;let t=[];if(o?(t=n.filter(p=>T.has(p.id)),t.length===0&&(t=n.filter(p=>p.id===o))):t=n,t=t.filter(p=>typeof p.x=="number"&&typeof p.y=="number"),t.length===0)return;const a={minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0};t.forEach(p=>{a.minX=Math.min(a.minX,p.x),a.maxX=Math.max(a.maxX,p.x),a.minY=Math.min(a.minY,p.y),a.maxY=Math.max(a.maxY,p.y)});const l=f.current.clientWidth,s=f.current.clientHeight,c=100,m=a.maxX-a.minX||10,d=a.maxY-a.minY||10,v=(a.minX+a.maxX)/2,S=(a.minY+a.maxY)/2;let y=.9/Math.max(m/(l-c*2),d/(s-c*2));y=Math.max(.01,Math.min(2,y));const D=[l/2-y*v,s/2-y*S];G(x.current).transition().duration(750).call(h.current.transform,Q.translate(D[0],D[1]).scale(y))},[n,o,T]);i.useEffect(()=>{const t=setTimeout(()=>{B()},800);return()=>clearTimeout(t)},[n.length===0]);const{displayNodes:E,displayLinks:R}=i.useMemo(()=>{const t=w.filter(s=>s.value>=W),a=new Set;return t.forEach(s=>{const c=typeof s.source=="object"?s.source.id:s.source,m=typeof s.target=="object"?s.target.id:s.target;a.add(c),a.add(m)}),{displayNodes:n.filter(s=>a.has(s.id)||s.id===o),displayLinks:t}},[n,w,W,o]),Y=t=>{if(t==="all")H({start:"",end:""});else{const a=new Date,l=new Date;l.setDate(l.getDate()-t),H({start:l.toISOString().slice(0,16),end:a.toISOString().slice(0,16)})}z(!1)},ie=()=>{if(!u.start&&!u.end)return"All Time";const t=u.start?new Date(u.start).toLocaleDateString():"Start",a=u.end?new Date(u.end).toLocaleDateString():"Now";return`${t} - ${a}`};return i.useEffect(()=>{if(!x.current||!f.current)return;const t=f.current.clientWidth,a=f.current.clientHeight,l=G(x.current).attr("viewBox",[0,0,t,a]).on("click",re);l.select("defs").empty()&&l.append("defs").append("marker").attr("id","arrow-unified").attr("viewBox","0 -5 10 10").attr("refX",18).attr("refY",0).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill","#64748b");let s=l.select(".main-group");s.empty()&&(s=l.append("g").attr("class","main-group"),s.append("g").attr("class","link-group"),s.append("g").attr("class","node-group")),h.current||(h.current=me().scaleExtent([.01,8]).on("zoom",r=>s.attr("transform",r.transform)),l.call(h.current));const c=s.select(".link-group"),m=s.select(".node-group"),d=c.selectAll("line").data(R,r=>`${r.source.id||r.source}-${r.target.id||r.target}`);d.exit().remove();const S=d.enter().append("line").attr("stroke","#475569").attr("stroke-opacity",.6).attr("marker-end","url(#arrow-unified)").merge(d).attr("class","graph-link").attr("stroke-width",r=>Math.min(Math.sqrt(r.value)*.5+.5,4)),y=s.select(".link-hit-group"),D=(y.empty()?s.insert("g",".node-group").attr("class","link-hit-group"):y).selectAll("line").data(R,r=>`${r.source.id||r.source}-${r.target.id||r.target}`);D.exit().remove();const ce=D.enter().append("line").attr("stroke","transparent").attr("stroke-width",10).style("cursor","pointer").on("click",(r,N)=>{r.stopPropagation();const ue=typeof N.source=="object"?N.source.id:N.source,xe=typeof N.target=="object"?N.target.id:N.target;oe(ue,xe)}).merge(D),q=m.selectAll("g").data(E,r=>r.id);q.exit().remove();const P=q.enter().append("g").attr("class","graph-node").attr("cursor","pointer").on("click",(r,N)=>ae(N,r));P.append("circle").attr("r",r=>Math.min(Math.sqrt(r.val||1)+3,25)).attr("stroke-width",1.5).attr("stroke","#1e293b"),P.append("text").attr("x",12).attr("y",4).attr("fill","#e2e8f0").attr("font-size","10px").style("pointer-events","none").style("text-shadow","0 1px 2px black").style("opacity",0).text(r=>r.id.length>8?r.id.slice(0,6)+"..":r.id);const de=P.merge(q);C.current&&C.current.stop();const F=fe(E).force("link",he(R).id(r=>r.id).distance(50)).force("charge",pe().strength(-30)).force("center",ge(t/2,a/2).strength(.8)).force("collide",be().radius(r=>Math.sqrt(r.val||1)+5).iterations(2));F.alpha(.5).restart(),F.on("end",()=>{E.forEach(r=>{r.fx=r.x,r.fy=r.y})}),F.on("tick",()=>{S.attr("x1",r=>r.source.x).attr("y1",r=>r.source.y).attr("x2",r=>r.target.x).attr("x2",r=>r.target.x).attr("y2",r=>r.target.y),ce.attr("x1",r=>r.source.x).attr("y1",r=>r.source.y).attr("x2",r=>r.target.x).attr("y2",r=>r.target.y),de.attr("transform",r=>`translate(${r.x},${r.y})`)}),C.current=F},[E,R]),i.useEffect(()=>{if(!x.current)return;const t=G(x.current),a=t.selectAll(".graph-node");t.selectAll(".graph-link").transition().duration(300).attr("stroke-opacity",s=>{if(!o)return .5;const c=typeof s.source=="object"?s.source.id:s.source,m=typeof s.target=="object"?s.target.id:s.target;return c===o||m===o?.8:.05}).attr("stroke",s=>{if(!o)return"#475569";const c=typeof s.source=="object"?s.source.id:s.source,m=typeof s.target=="object"?s.target.id:s.target;return c===o||m===o?"#818cf8":"#334155"}),a.transition().duration(300).style("opacity",s=>o?T.has(s.id)?1:.2:1),a.select("text").transition().duration(300).style("opacity",s=>s.id===o||o&&T.has(s.id)||!o&&(s.id.includes("_")||s.val>2e3)?1:0),a.select("circle").attr("fill",s=>s.id===o?"#a78bfa":s.id.includes("Whale")?"#f43f5e":s.id.includes("_")?"#8b5cf6":s.type==="source"?"#34d399":"#3b82f6").attr("stroke",s=>s.id===o?"#fff":"#1e293b").attr("stroke-width",s=>s.id===o?3:1.5)},[o,T,E]),e.jsxs("div",{className:"flex flex-col h-[calc(100vh-85px)] gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center shadow-lg shadow-indigo-500/20",children:e.jsx(ve,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Interactive Graph"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Visualize transaction relationships and network topology"})]})]}),e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-xl border border-slate-800 flex flex-col xl:flex-row gap-4 justify-between items-start xl:items-center z-20 shadow-sm shrink-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 w-full xl:w-auto",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:le,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg border border-transparent hover:border-slate-700",title:"Reset Layout",children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx("button",{onClick:B,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg border border-transparent hover:border-slate-700",title:"Fit to Screen",children:e.jsx(we,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"h-6 w-px bg-slate-800 hidden xl:block"}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>z(!_),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-sm font-medium transition-colors ${u.start||u.end?"bg-indigo-900/30 border-indigo-500/50 text-indigo-300":"bg-slate-950 border-slate-800 text-slate-300 hover:border-slate-700"}`,children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:ie()}),e.jsx(Ne,{className:"w-3 h-3 opacity-50"})]}),_&&e.jsxs("div",{className:"absolute top-full mt-2 left-0 w-72 bg-slate-900 border border-slate-700 rounded-xl shadow-2xl p-4 z-50 flex flex-col gap-4 animate-in fade-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>Y(1),className:"px-3 py-2 bg-slate-800 hover:bg-slate-700 rounded text-xs text-slate-300 transition-colors",children:"Last 24 Hours"}),e.jsx("button",{onClick:()=>Y(7),className:"px-3 py-2 bg-slate-800 hover:bg-slate-700 rounded text-xs text-slate-300 transition-colors",children:"Last 7 Days"}),e.jsx("button",{onClick:()=>Y(30),className:"px-3 py-2 bg-slate-800 hover:bg-slate-700 rounded text-xs text-slate-300 transition-colors",children:"Last 30 Days"}),e.jsx("button",{onClick:()=>Y("all"),className:"px-3 py-2 bg-slate-800 hover:bg-slate-700 rounded text-xs text-slate-300 transition-colors",children:"All Time"})]}),e.jsx("div",{className:"h-px bg-slate-800"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-xs text-slate-500 uppercase font-semibold",children:"Custom Range"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Start"}),e.jsx("input",{type:"datetime-local",className:"w-full bg-slate-950 border border-slate-700 rounded px-2 py-1.5 text-xs text-white focus:outline-none focus:border-indigo-500",value:u.start,onChange:t=>H(a=>({...a,start:t.target.value}))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"End"}),e.jsx("input",{type:"datetime-local",className:"w-full bg-slate-950 border border-slate-700 rounded px-2 py-1.5 text-xs text-white focus:outline-none focus:border-indigo-500",value:u.end,onChange:t=>H(a=>({...a,end:t.target.value}))})]})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx("button",{onClick:()=>z(!1),className:"px-3 py-1 bg-indigo-600 hover:bg-indigo-500 text-white rounded text-xs font-medium",children:"Done"})})]}),_&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>z(!1)})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-950 px-3 py-1.5 rounded-lg border border-slate-800",title:"Minimum Transaction Value",children:[e.jsx(ke,{className:"w-3 h-3 text-slate-500"}),e.jsx("span",{className:"text-xs text-slate-500 hidden sm:inline",children:"Min Amt:"}),e.jsx("input",{type:"number",className:"bg-transparent text-xs text-slate-300 focus:outline-none w-16",value:W,onChange:t=>ee(Number(t.target.value)),placeholder:"0"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-950 px-3 py-1.5 rounded-lg border border-slate-800",children:[e.jsx(Se,{className:"w-3 h-3 text-emerald-500"}),e.jsx("input",{type:"number",className:"bg-transparent text-xs text-slate-300 focus:outline-none w-16",value:X,onChange:t=>te(t.target.value),placeholder:"Min In"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-950 px-3 py-1.5 rounded-lg border border-slate-800",children:[e.jsx(Ce,{className:"w-3 h-3 text-orange-500"}),e.jsx("input",{type:"number",className:"bg-transparent text-xs text-slate-300 focus:outline-none w-16",value:$,onChange:t=>se(t.target.value),placeholder:"Min Out"})]})]})]}),e.jsxs("form",{onSubmit:ne,className:"relative w-full xl:w-64",children:[e.jsx("input",{type:"text",placeholder:"Search Address...",className:"w-full bg-slate-950 border border-slate-700 text-slate-200 pl-10 pr-4 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500/50",value:L,onChange:t=>K(t.target.value)}),e.jsx(Me,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"})]})]}),b&&e.jsx("div",{className:"absolute inset-0 bg-slate-950/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl w-full max-w-4xl h-[80%] flex flex-col shadow-2xl relative",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex justify-between items-center bg-slate-800/50 rounded-t-xl",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-bold text-lg",children:"Transaction History"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400 mt-1",children:[e.jsx("span",{className:"font-mono bg-slate-800 px-2 py-0.5 rounded border border-slate-700",children:b.source}),e.jsx("span",{children:"â†”"}),e.jsx("span",{className:"font-mono bg-slate-800 px-2 py-0.5 rounded border border-slate-700",children:b.target})]})]}),e.jsx("button",{onClick:()=>V(null),className:"p-2 hover:bg-slate-700 rounded-lg text-slate-400 hover:text-white transition-colors",children:e.jsx(U,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-hidden p-4",children:e.jsx(Ee,{transactions:Z})})]})}),e.jsxs("div",{className:"flex-1 flex gap-4 overflow-hidden relative",children:[e.jsxs("div",{className:"flex-1 bg-slate-950 rounded-xl border border-slate-800 relative overflow-hidden shadow-inner",ref:f,children:[e.jsx("svg",{ref:x,className:"w-full h-full cursor-grab active:cursor-grabbing"}),e.jsxs("div",{className:"absolute top-4 left-4 pointer-events-none z-10",children:[e.jsx("h3",{className:"text-white font-semibold text-sm shadow-black drop-shadow-md",children:"Network Explorer"}),e.jsxs("div",{className:"mt-2 text-[10px] text-slate-500 bg-slate-900/50 p-1 rounded inline-block border border-slate-800/50",children:["Nodes: ",E.length," | Links: ",R.length]})]}),e.jsxs("div",{className:"absolute bottom-4 left-4 flex flex-wrap gap-3 pointer-events-none z-10",children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-slate-900/80 rounded border border-slate-800",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-violet-500 shadow-[0_0_5px_rgba(139,92,246,0.6)]"})," ",e.jsx("span",{className:"text-[10px] text-slate-300",children:"Entity/Hub"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-slate-900/80 rounded border border-slate-800",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-rose-500 shadow-[0_0_5px_rgba(244,63,94,0.6)]"})," ",e.jsx("span",{className:"text-[10px] text-slate-300",children:"Whale"})]})]})]}),o&&e.jsxs("div",{className:"absolute top-0 right-0 h-full w-80 bg-slate-900/95 backdrop-blur border-l border-slate-800 p-6 flex flex-col shadow-2xl transition-transform animate-in slide-in-from-right duration-200 z-20",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs uppercase text-slate-500 font-bold tracking-wider",children:"Wallet Details"}),e.jsx("p",{className:"text-white font-mono text-sm break-all mt-1 copyable","data-copy":o,children:o})]}),e.jsx("button",{onClick:()=>I(null),className:"text-slate-500 hover:text-white",children:e.jsx(U,{className:"w-5 h-5"})})]}),k&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-slate-800/50 rounded-lg border border-slate-700/50",children:[e.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"Net Flow"}),e.jsxs("div",{className:`text-2xl font-bold ${k.net>=0?"text-emerald-400":"text-orange-400"}`,children:[k.net>0?"+":"",k.net.toLocaleString(void 0,{maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Total In"}),e.jsxs("div",{className:"text-emerald-500 font-medium",children:["+",k.inflow.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Total Out"}),e.jsxs("div",{className:"text-orange-500 font-medium",children:["-",k.outflow.toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Activity"}),e.jsxs("div",{className:"text-white font-medium",children:[k.count," Transactions"]})]})]})]})]})]})};export{Ae as default,J as generateGraphData};
