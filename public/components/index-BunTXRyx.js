const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./walletcard-DIzvSLp4.js","../vendor-u8cx4Mps.js","../index-DGMj3aU4.js","../index-Bs_JqdHU.css","./connectionpanel-DTsq24Lt.js","./connectionrenderer-eHsXNhHc.js","./walletpanel-DmbnARVC.js"])))=>i.map(i=>d[i]);
import{_ as R,L as _}from"../index-DGMj3aU4.js";import{r as o,s as S,t as ue,u as Q,j as t,v as q,w as me,P as xe,Z as he,x as fe,M as ge,y as pe,z as we,G as be,E as ve,n as E}from"../vendor-u8cx4Mps.js";const je=E(()=>R(()=>import("./walletcard-DIzvSLp4.js"),__vite__mapDeps([0,1,2,3]),import.meta.url),{fallback:_}),ye=E(()=>R(()=>import("./connectionpanel-DTsq24Lt.js"),__vite__mapDeps([4,1,2,3]),import.meta.url),{fallback:_}),Ce=E(()=>R(()=>import("./connectionrenderer-eHsXNhHc.js"),__vite__mapDeps([5,1,2,3]),import.meta.url),{fallback:_}),Ne=E(()=>R(()=>import("./walletpanel-DmbnARVC.js"),__vite__mapDeps([6,1,2,3]),import.meta.url),{fallback:_}),m=250,Me=80,ke=20,J=180,_e=({transactions:x})=>{var H,U;const[a,C]=o.useState([]),[i,j]=o.useState(null),[h,A]=o.useState(null),[f,I]=o.useState(""),[g,K]=o.useState({x:0,y:0,k:1}),[N,P]=o.useState("curve"),[p,z]=o.useState(null),W=o.useRef({x:0,y:0}),D=o.useRef({laneIndex:0,yPosition:0}),[M,ee]=o.useState(400),[k,Y]=o.useState(!1),L=o.useRef({x:0,width:400});o.useRef(null),o.useRef(null);const u=o.useRef(null),y=o.useRef(null),w=o.useRef(null),$=o.useMemo(()=>{const e=new Map;return x.forEach(s=>{const n=e.get(s.from)||{inflow:0,outflow:0,txCount:0};n.outflow+=s.amount,n.txCount++,e.set(s.from,n);const r=e.get(s.to)||{inflow:0,outflow:0,txCount:0};r.inflow+=s.amount,r.txCount++,e.set(s.to,r)}),e},[x]),T=o.useMemo(()=>{const e=new Set;return x.forEach(s=>{e.add(s.from),e.add(s.to)}),Array.from(e)},[x]),te=o.useMemo(()=>{const e=new Set(a.map(n=>n.address)),s=new Map;return x.forEach(n=>{if(e.has(n.from)&&e.has(n.to)){const r=`${n.from}->${n.to}`,l=s.get(r)||{fromAddress:n.from,toAddress:n.to,totalAmount:0,txCount:0,transactions:[]};l.totalAmount+=n.amount,l.txCount++,l.transactions.push(n),s.set(r,l)}}),Array.from(s.values())},[a,x]),G=o.useMemo(()=>{const e=new Map;return a.forEach(s=>{const n=s.laneIndex*m+m/2,r=s.yPosition;e.set(s.address,{x:n,y:r,leftEdge:n-J/2,rightEdge:n+J/2})}),e},[a]),b=o.useMemo(()=>{if(a.length===0)return{minX:-2,maxX:5,minY:-500,maxY:1500};const e=a.map(v=>v.laneIndex),s=a.map(v=>v.yPosition),n=Math.min(...e),r=Math.max(...e),l=Math.min(...s),c=Math.max(...s);return{minX:Math.min(-2,n-2),maxX:Math.max(5,r+3),minY:Math.min(-500,l-500),maxY:Math.max(1500,c+500)}},[a]);o.useEffect(()=>{if(!u.current||!y.current)return;const e=S(u.current),s=ue().scaleExtent([.1,4]).filter(r=>{var l;if(r.type==="wheel")return!0;if(r.type==="mousedown"){let c=r.target;for(;c&&c!==u.current;){if((l=c.classList)!=null&&l.contains("wallet-card"))return!1;c=c.parentElement}}return!r.button}).on("zoom",r=>{K({x:r.transform.x,y:r.transform.y,k:r.transform.k})});e.call(s),w.current=s;const n=Q.translate(100,200).scale(1);return e.call(s.transform,n),()=>{e.on(".zoom",null)}},[]);const O=o.useCallback((e,s,n)=>{if(a.some(d=>d.address===e))return;const r=$.get(e)||{inflow:0,outflow:0,txCount:0};let l=0;s!==void 0&&(l=n?s-1:s+1);const c=a.filter(d=>d.laneIndex===l),v=c.length>0?Math.max(...c.map(d=>d.yPosition))+Me+ke:100,X={address:e,laneIndex:l,yPosition:v,totalInflow:r.inflow,totalOutflow:r.outflow,txCount:r.txCount};C(d=>[...d,X]),I("")},[a,$]),se=o.useCallback(e=>{C(s=>s.filter(n=>n.address!==e)),i===e&&j(null)},[i]),ne=e=>{e.preventDefault(),f.trim()&&T.includes(f.trim())&&O(f.trim())},oe=o.useCallback((e,s)=>{e.stopPropagation(),e.preventDefault();const n=a.find(r=>r.address===s);n&&(z(s),W.current={x:e.clientX,y:e.clientY},D.current={laneIndex:n.laneIndex,yPosition:n.yPosition})},[a]),re=o.useCallback(e=>{if(!p)return;const s=(e.clientX-W.current.x)/g.k,n=(e.clientY-W.current.y)/g.k,l=D.current.laneIndex*m+m/2+s,c=Math.round((l-m/2)/m),v=D.current.yPosition+n;C(X=>X.map(d=>d.address===p?{...d,laneIndex:c,yPosition:v}:d))},[p,g.k]),Z=o.useCallback(()=>{p&&z(null)},[p]),ae=()=>{u.current&&w.current&&S(u.current).transition().duration(300).call(w.current.scaleBy,1.3)},le=()=>{u.current&&w.current&&S(u.current).transition().duration(300).call(w.current.scaleBy,.7)},ie=()=>{if(!u.current||!y.current||!w.current)return;const e=y.current.clientWidth,s=y.current.clientHeight,n=Q.translate(e/4,s/3).scale(.8);S(u.current).transition().duration(500).call(w.current.transform,n)},B=o.useMemo(()=>{if(!f.trim())return[];const e=f.toLowerCase();return T.filter(s=>s.toLowerCase().includes(e)&&!a.some(n=>n.address===s)).slice(0,5)},[f,T,a]),ce=o.useMemo(()=>new Set(a.map(e=>e.address)),[a]),de=o.useMemo(()=>{var e;if(i)return(e=a.find(s=>s.address===i))==null?void 0:e.laneIndex},[i,a]),V=o.useMemo(()=>i&&a.find(e=>e.address===i)||null,[i,a]),F=o.useCallback(e=>{e.preventDefault(),Y(!0),L.current={x:e.clientX,width:M}},[M]);return o.useEffect(()=>{if(!k)return;const e=n=>{const r=L.current.x-n.clientX,l=Math.min(800,Math.max(300,L.current.width+r));ee(l)},s=()=>{Y(!1)};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",s),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",s)}},[k]),t.jsxs("div",{className:"flex flex-col h-[calc(100vh-50px)] gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg flex items-center justify-center shadow-lg shadow-amber-500/20",children:t.jsx(q,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"Arkham Tracer"}),t.jsx("p",{className:"text-slate-400 text-sm",children:"Trace wallet connections and transaction flows"})]})]}),t.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-xl border border-slate-800 flex flex-wrap items-center gap-4 shrink-0",children:[t.jsxs("form",{onSubmit:ne,className:"relative flex-1 max-w-md",children:[t.jsx("input",{type:"text",placeholder:"Search wallet address...",value:f,onChange:e=>I(e.target.value),className:"w-full bg-slate-950 border border-slate-700 text-slate-200 pl-10 pr-4 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500/50"}),t.jsx(me,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),B.length>0&&t.jsx("div",{className:"absolute top-full mt-1 left-0 right-0 bg-slate-900 border border-slate-700 rounded-lg shadow-xl z-50 overflow-hidden",children:B.map(e=>t.jsxs("button",{type:"button",onClick:()=>{O(e),I("")},className:"w-full px-4 py-2 text-left text-sm text-slate-200 hover:bg-slate-800 flex items-center gap-2",children:[t.jsx(xe,{className:"w-4 h-4 text-indigo-400"}),t.jsx("span",{className:"font-mono truncate",children:e})]},e))})]}),t.jsxs("div",{className:"flex items-center gap-1 border-l border-slate-800 pl-4",children:[t.jsx("button",{onClick:le,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg",title:"Zoom Out",children:t.jsx(he,{className:"w-4 h-4"})}),t.jsx("button",{onClick:ae,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg",title:"Zoom In",children:t.jsx(fe,{className:"w-4 h-4"})}),t.jsx("button",{onClick:ie,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg",title:"Fit View",children:t.jsx(ge,{className:"w-4 h-4"})})]}),t.jsx("div",{className:"flex items-center gap-1 border-l border-slate-800 pl-4",children:t.jsxs("div",{className:"flex gap-1 bg-slate-950 rounded-lg p-1 border border-slate-700",children:[t.jsx("button",{onClick:()=>P("curve"),className:`p-2 rounded transition-colors ${N==="curve"?"bg-indigo-600 text-white":"text-slate-400 hover:text-slate-200"}`,title:"Curved connections",children:t.jsx(pe,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>P("straight"),className:`p-2 rounded transition-colors ${N==="straight"?"bg-indigo-600 text-white":"text-slate-400 hover:text-slate-200"}`,title:"Straight line connections",children:t.jsx(we,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>P("step"),className:`p-2 rounded transition-colors ${N==="step"?"bg-indigo-600 text-white":"text-slate-400 hover:text-slate-200"}`,title:"Step/elbow connections",children:t.jsx(be,{className:"w-4 h-4"})})]})}),a.length>0&&t.jsxs("button",{onClick:()=>{C([]),j(null)},className:"flex items-center gap-2 px-3 py-2 text-sm text-red-400 hover:bg-red-500/10 rounded-lg border border-red-500/30",children:[t.jsx(ve,{className:"w-4 h-4"}),"Clear All"]})]}),t.jsxs("div",{className:"flex-1 flex gap-1 min-h-0",children:[t.jsxs("div",{ref:y,className:`${i?"flex-1":"w-full"} bg-slate-950 rounded-xl border border-slate-800 overflow-hidden relative`,onMouseMove:re,onMouseUp:Z,onMouseLeave:Z,children:[t.jsxs("svg",{ref:u,className:"w-full h-full",style:{cursor:p?"grabbing":"grab"},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"laneGradient",x1:"0",y1:b.minY,x2:"0",y2:b.maxY,gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0%",stopColor:"#475569",stopOpacity:"0"}),t.jsx("stop",{offset:"20%",stopColor:"#475569",stopOpacity:"0.4"}),t.jsx("stop",{offset:"50%",stopColor:"#475569",stopOpacity:"0.6"}),t.jsx("stop",{offset:"80%",stopColor:"#475569",stopOpacity:"0.4"}),t.jsx("stop",{offset:"100%",stopColor:"#475569",stopOpacity:"0"})]})}),t.jsxs("g",{transform:`translate(${g.x}, ${g.y}) scale(${g.k})`,children:[Array.from({length:b.maxX-b.minX}).map((e,s)=>{const n=b.minX+s;return t.jsx("line",{x1:n*m+m/2,y1:b.minY,x2:n*m+m/2,y2:b.maxY,stroke:"url(#laneGradient)",strokeWidth:2,strokeDasharray:"8 4"},`lane-${n}`)}),t.jsx(Ce,{connections:te,walletPositions:G,transform:g,connectionStyle:N,selectedConnection:h?{from:((H=h.aToB)==null?void 0:H.fromAddress)||h.addressA,to:((U=h.aToB)==null?void 0:U.toAddress)||h.addressB}:null,onConnectionClick:e=>{A(e),j(null)}}),a.map(e=>{const s=G.get(e.address);return s?t.jsx(je,{wallet:e,isSelected:i===e.address,isDragging:p===e.address,position:s,onSelect:()=>{j(e.address),A(null)},onDragStart:n=>oe(n,e.address)},e.address):null})]})]}),a.length===0&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(q,{className:"w-8 h-8 text-slate-600"})}),t.jsx("p",{className:"text-slate-400 text-lg mb-2",children:"No wallets added yet"}),t.jsx("p",{className:"text-slate-500 text-sm",children:"Search for a wallet address above to start tracing"})]})})]}),i&&V&&t.jsxs(t.Fragment,{children:[t.jsx("div",{onMouseDown:F,className:`w-2 flex-shrink-0 cursor-col-resize group flex items-center justify-center hover:bg-indigo-500/20 transition-colors rounded ${k?"bg-indigo-500/30":""}`,children:t.jsx("div",{className:"w-1 h-16 bg-slate-700 group-hover:bg-indigo-500 transition-colors rounded"})}),t.jsx("div",{style:{width:M},className:"shrink-0",children:t.jsx(Ne,{selectedWallet:i,wallet:V,transactions:x,onClose:()=>j(null),onRemoveWallet:se,onAddWallet:O,existingWalletSet:ce,selectedWalletLane:de})})]}),h&&t.jsxs(t.Fragment,{children:[t.jsx("div",{onMouseDown:F,className:`w-2 flex-shrink-0 cursor-col-resize group flex items-center justify-center hover:bg-indigo-500/20 transition-colors rounded ${k?"bg-indigo-500/30":""}`,children:t.jsx("div",{className:"w-1 h-16 bg-slate-700 group-hover:bg-indigo-500 transition-colors rounded"})}),t.jsx("div",{style:{width:M},className:"shrink-0",children:t.jsx(ye,{connection:h,onClose:()=>A(null)})})]})]})]})};export{_e as default};
