import{r as d,a3 as J,a4 as K,a5 as Y,a6 as _,a7 as Q,j as t,a8 as X,S as P,D as Z}from"../vendor-DWEmHMvc.js";import{u as ee,c as te}from"../index-CodYiM9M.js";import se from"./loadingspinner--iLA6-au.js";import ae from"./exportbutton-DLkyn2ZO.js";const oe=({transactions:C,initialSource:R="",initialTarget:z=""})=>{const u=d.useRef(null),[r,H]=d.useState(R),[x,U]=d.useState(z),[p,D]=d.useState(5),[a,I]=d.useState(null),[f,A]=d.useState(!1),{executeTask:O}=ee(),W=async()=>{if(!(!r||!x)){A(!0);try{const s=await O({type:"TAINT_ANALYSIS",payload:{transactions:C,sourceAddress:r,targetAddress:x,maxHops:p}});I(s)}catch(s){console.error("Taint analysis failed:",s),alert("Taint analysis failed. Please check the console for details.")}finally{A(!1)}}};d.useEffect(()=>{a&&u.current&&B()},[a]);const B=()=>{if(!u.current||!a)return;const s={top:20,right:150,bottom:20,left:150},i=1200-s.left-s.right,c=600-s.top-s.bottom,n=select(u.current);n.selectAll("*").remove();const v=n.append("g").attr("transform",`translate(${s.left},${s.top})`),h=new Map,g=new Map;a.paths.forEach(e=>{if(!(e.path.length<2))for(let l=0;l<e.path.length;l++){const m=e.path[l];if(h.has(m)||h.set(m,{name:m.slice(0,8)+"..."+m.slice(-6),address:m}),l<e.path.length-1){const o=e.path[l],N=e.path[l+1],S=`${o}->${N}`,M=e.amount;g.has(S)?g.get(S).value+=M:g.set(S,{source:o,target:N,value:M})}}});const y=Array.from(h.values()),b=[],w=new Set,$=new Set,j=new Map;g.forEach((e,l)=>{j.has(e.source)||j.set(e.source,[]),j.get(e.source).push(e.target)});const E=new Set,k=(e,l)=>{w.add(e),l.add(e),(j.get(e)||[]).forEach(o=>{const N=`${e}->${o}`;l.has(o)?console.warn(`Cycle detected: dropping link ${e} -> ${o}`):(E.add(N),w.has(o)||k(o,l))}),l.delete(e)};if(h.has(r)&&k(r,$),y.forEach(e=>{w.has(e.address)||k(e.address,$)}),g.forEach((e,l)=>{E.has(l)&&b.push({source:h.get(e.source),target:h.get(e.target),value:e.value,percentage:e.value/a.totalTainted*100})}),y.length===0||b.length===0)return;const q=y,L=J().nodeWidth(20).nodePadding(20).extent([[0,0],[i,c]]),T=L({nodes:q.map(e=>({...e})),links:b.map(e=>({...e}))}),G=K(Y).domain([0,_(b,e=>e.percentage)||100]);v.append("g").selectAll(".link").data(T.links).enter().append("path").attr("class","link").attr("d",Q()).attr("stroke",e=>G(e.percentage)).attr("stroke-width",e=>Math.max(1,e.width||0)).attr("fill","none").attr("opacity",.5).append("title").text(e=>`${e.source.name} → ${e.target.name}
Taint: ${e.value.toLocaleString()}
Percentage: ${e.percentage.toFixed(2)}%`),v.append("g").selectAll(".link-label").data(T.links.filter(e=>e.percentage>5)).enter().append("text").attr("class","link-label").attr("x",e=>((e.source.x1||0)+(e.target.x0||0))/2).attr("y",e=>((e.y0||0)+(e.y1||0))/2).attr("text-anchor","middle").attr("fill","#e2e8f0").attr("font-size","11px").attr("font-weight","bold").text(e=>`${e.percentage.toFixed(1)}%`);const F=v.append("g").selectAll(".node").data(T.nodes).enter().append("g").attr("class","node");F.append("rect").attr("x",e=>e.x0||0).attr("y",e=>e.y0||0).attr("height",e=>(e.y1||0)-(e.y0||0)).attr("width",L.nodeWidth()).attr("fill",e=>e.address===r?"#6366f1":e.address===x?"#ef4444":"#64748b").attr("stroke","#1e293b").attr("stroke-width",2).append("title").text(e=>`${e.name}
${e.address}`),F.append("text").attr("x",e=>(e.x0||0)<i/2?(e.x1||0)+6:(e.x0||0)-6).attr("y",e=>((e.y1||0)+(e.y0||0))/2).attr("dy","0.35em").attr("text-anchor",e=>(e.x0||0)<i/2?"start":"end").attr("fill","#e2e8f0").attr("font-size","12px").text(e=>e.name)},V=s=>{if(a)if(s==="csv")te(a);else{const i=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),c=URL.createObjectURL(i),n=document.createElement("a");n.href=c,n.download=`taint-analysis-${r.slice(0,8)}-to-${x.slice(0,8)}.json`,n.click(),URL.revokeObjectURL(c)}};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-pink-500 to-rose-600 rounded-lg flex items-center justify-center shadow-lg shadow-pink-500/20",children:t.jsx(X,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"Taint Analysis"}),t.jsx("p",{className:"text-slate-400 text-sm",children:"Track fund flow percentages between addresses"})]})]}),t.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6 space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[t.jsx(P,{className:"w-4 h-4 inline mr-1"}),"Source Address"]}),t.jsx("input",{type:"text",value:r,onChange:s=>H(s.target.value),placeholder:"Enter source address...",className:"w-full bg-slate-950 border border-slate-700 text-slate-200 px-4 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:[t.jsx(P,{className:"w-4 h-4 inline mr-1"}),"Target Address"]}),t.jsx("input",{type:"text",value:x,onChange:s=>U(s.target.value),placeholder:"Enter target address...",className:"w-full bg-slate-950 border border-slate-700 text-slate-200 px-4 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Max Hops: ",p]}),t.jsx("input",{type:"range",min:2,max:10,value:p,onChange:s=>D(parseInt(s.target.value)),className:"w-full",style:{background:`linear-gradient(to right, #6366f1 0%, #6366f1 ${(p-2)/8*100}%, #334155 ${(p-2)/8*100}%, #334155 100%)`}})]}),t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsx("button",{onClick:W,disabled:!r||!x||f,className:"px-6 py-2 bg-indigo-600 hover:bg-indigo-500 disabled:bg-slate-700 disabled:text-slate-500 text-white rounded-lg font-medium transition-colors",children:"Analyze Taint"}),a&&t.jsx(ae,{onExport:V,formats:["csv","json"],label:"Export"})]})]})]}),f&&t.jsx("div",{className:"bg-slate-950 border border-slate-800 rounded-xl",children:t.jsx(se,{message:"Analyzing fund flow..."})}),a&&!f&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[t.jsx("h3",{className:"text-white font-semibold mb-4",children:"Taint Analysis Summary"}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-slate-500 text-xs mb-1",children:"Total Taint Amount"}),t.jsx("p",{className:"text-white text-xl font-bold",children:a.totalTainted.toLocaleString()})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-slate-500 text-xs mb-1",children:"Taint Percentage"}),t.jsxs("p",{className:"text-white text-xl font-bold",children:[a.taintPercentage.toFixed(2),"%"]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-slate-500 text-xs mb-1",children:"Paths Found"}),t.jsx("p",{className:"text-white text-xl font-bold",children:a.paths.length})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-slate-500 text-xs mb-1",children:"Max Hops Used"}),t.jsx("p",{className:"text-white text-xl font-bold",children:Math.max(...a.paths.map(s=>s.hops),0)})]})]})]}),t.jsxs("div",{className:"bg-slate-950 border border-slate-800 rounded-xl p-6",children:[t.jsx("h3",{className:"text-white font-semibold mb-4",children:"Fund Flow Diagram"}),t.jsx("svg",{ref:u,className:"w-full",style:{height:"600px"}}),t.jsxs("div",{className:"mt-4 flex items-center gap-4 text-xs text-slate-400",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 bg-indigo-600 rounded"}),t.jsx("span",{children:"Source"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 bg-red-600 rounded"}),t.jsx("span",{children:"Target"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 bg-slate-600 rounded"}),t.jsx("span",{children:"Intermediate"})]})]})]}),t.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[t.jsxs("h3",{className:"text-white font-semibold mb-4",children:["Top Taint Paths (",a.paths.slice(0,10).length,")"]}),t.jsxs("div",{className:"space-y-3",children:[a.paths.slice(0,10).map((s,i)=>t.jsxs("div",{className:"bg-slate-950 border border-slate-700 rounded-lg p-4",children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsxs("div",{children:[t.jsxs("span",{className:"text-slate-500 text-xs",children:["Path #",i+1]}),t.jsx("div",{className:"text-white text-sm font-mono mt-1",children:s.path.map((c,n)=>t.jsxs("span",{children:[c.slice(0,6),"...",c.slice(-4),n<s.path.length-1&&t.jsx("span",{className:"text-indigo-400 mx-1",children:"→"})]},n))})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-slate-500 text-xs",children:"Taint Amount"}),t.jsx("p",{className:"text-white font-bold",children:s.amount.toLocaleString()})]})]}),t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("span",{className:"text-slate-400",children:[s.hops," hops"]}),t.jsxs("span",{className:"text-indigo-400 font-semibold",children:[s.taintPercentage.toFixed(2),"% of target funds"]})]})]},i)),a.paths.length>10&&t.jsxs("p",{className:"text-slate-500 text-sm text-center py-2",children:["+",a.paths.length-10," more paths (export to view all)"]})]})]})]}),!a&&!f&&t.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-12 text-center",children:[t.jsx(Z,{className:"w-16 h-16 text-slate-700 mx-auto mb-4"}),t.jsx("p",{className:"text-slate-300 text-lg mb-2",children:"Taint Analysis"}),t.jsx("p",{className:"text-slate-500",children:"Track what percentage of funds from a source address reached a target address"})]})]})};export{oe as default};
