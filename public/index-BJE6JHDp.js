const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./components/fileupload-9s_BLtel.js","./vendor-Bvlc0P6K.js","./components/walletscanner-DRWDCGTD.js","./components/summarystats-InDTjXKm.js","./components/chartssection-CshOC2K6.js","./components/transactiontable-DR116WtF.js","./components/moneyflow-CKbXzbY5.js","./components/unifiedgraph-w_4yEjFQ.js","./components/forensicsdashboard-H2KHPed7.js","./components/pathfinder-Cu_LyH2U.js","./components/timelinetracer-Co6Zd89z.js","./components/taintchart-B-g6fgxl.js","./components/loadingspinner-CCRV7N65.js","./components/exportbutton-B_sO2VGG.js","./components/walletanalysis-D65TPafM.js","./components/index-1qNSQp_h.js"])))=>i.map(i=>d[i]);
import{r as _,j as g,H as G,n as A,az as U,aA as X,w as J,ah as Y,I as Q,N as Z,Q as ee,g as te,o as se,aB as oe,ae as ne}from"./vendor-Bvlc0P6K.js";import"./index-BJE6JHDp.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();function Ge(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}const ae="modulepreload",re=function(t,n){return new URL(t,n).href},B={},M=function(n,e,o){let r=Promise.resolve();if(e&&e.length>0){let a=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};const s=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),d=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));r=a(e.map(l=>{if(l=re(l,o),l in B)return;B[l]=!0;const u=l.endsWith(".css"),m=u?'[rel="stylesheet"]':"";if(!!o)for(let h=s.length-1;h>=0;h--){const w=s[h];if(w.href===l&&(!u||w.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${m}`))return;const p=document.createElement("link");if(p.rel=u?"stylesheet":ae,u||(p.as="script"),p.crossOrigin="",p.href=l,d&&p.setAttribute("nonce",d),document.head.appendChild(p),u)return new Promise((h,w)=>{p.addEventListener("load",h),p.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(a){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return r.then(a=>{for(const s of a||[])s.status==="rejected"&&i(s.reason);return n().catch(i)})},ie=t=>{if(t.length===0)return{totalVolume:0,transactionCount:0,uniqueAddresses:0,avgTransactionValue:0,maxTransactionValue:0,startDate:new Date,endDate:new Date,topAddress:""};const n=t.reduce((s,c)=>s+c.amount,0),e=new Map;t.forEach(s=>{e.set(s.from,(e.get(s.from)||0)+s.amount),e.set(s.to,(e.get(s.to)||0)+s.amount)});let o="",r=0;e.forEach((s,c)=>{s>r&&(r=s,o=c)});const i=Math.max(...t.map(s=>s.amount)),a=t.map(s=>s.date.getTime());return{totalVolume:n,transactionCount:t.length,uniqueAddresses:e.size,avgTransactionValue:n/t.length,maxTransactionValue:i,startDate:new Date(Math.min(...a)),endDate:new Date(Math.max(...a)),topAddress:o}},ce=t=>{const n=new Map;return t.forEach(e=>{const o=e.date.toISOString().split("T")[0],r=n.get(o)||{volume:0,count:0};n.set(o,{volume:r.volume+e.amount,count:r.count+1})}),Array.from(n.entries()).map(([e,o])=>({date:e,...o})).sort((e,o)=>e.date.localeCompare(o.date))},le=t=>{if(t.length===0)return 0;let n=0;const o=t.filter(s=>{const c=s.amount;return c>=1e3&&c%1e3===0}).length/t.length;n+=o*30;const r=[...t].sort((s,c)=>s.date.getTime()-c.date.getTime());let i=0;for(let s=1;s<r.length;s++)r[s].date.getTime()-r[s-1].date.getTime()<300*1e3&&i++;r.length>1&&(n+=i/(r.length-1)*30);const a=Math.min(t.length*3,20);if(n+=a,t.length>1){const s=t.map(m=>m.amount),c=s.reduce((m,f)=>m+f,0)/s.length,d=s.reduce((m,f)=>m+Math.pow(f-c,2),0)/s.length,l=Math.sqrt(d),u=c>0?l/c:1;u<.1?n+=20:u<.3&&(n+=10)}return Math.min(n,100)},ue=(t,n,e,o=10,r=100)=>{const i=performance.now(),a=new Map;t.forEach(u=>{a.has(u.from)||a.set(u.from,[]),a.get(u.from).push({tx:u,to:u.to})});const s=[],c=(u,m,f,p,h)=>{if(s.length>=r||h>o)return;if(u===e){const S=p.reduce((v,b)=>v+b.amount,0),x=p.map(v=>v.date.getTime()).sort((v,b)=>v-b),y=x.slice(1).map((v,b)=>v-x[b]);s.push({addresses:[...f,u],transactions:[...p],totalAmount:S,hops:p.length,startDate:new Date(x[0]),endDate:new Date(x[x.length-1]),avgDelay:y.length>0?y.reduce((v,b)=>v+b,0)/y.length:0,suspicionScore:le(p)});return}const w=a.get(u)||[];for(const{tx:S,to:x}of w)m.has(x)||(m.add(x),c(x,m,[...f,u],[...p,S],h+1),m.delete(x))};c(n,new Set([n]),[],[],0);const l=s.length>0?s.reduce((u,m)=>m.hops<u.hops?m:u,s[0]):null;return{source:n,target:e,paths:s,shortestPath:l,statistics:{totalPathsFound:s.length,avgPathLength:s.length>0?s.reduce((u,m)=>u+m.hops,0)/s.length:0,executionTime:performance.now()-i}}},Xe=(t,n,e,o=10)=>{const r=ue(t,n,e,o,1e3),i=[];let a=0;r.paths.forEach(l=>{if(l.transactions.length===0)return;let u=l.transactions[0].amount;for(let m=0;m<l.transactions.length;m++){const f=l.transactions[m],p=f.from,w=t.filter(S=>S.from===p&&S.date>=f.date&&S.date<=new Date(f.date.getTime()+1440*60*1e3)).reduce((S,x)=>S+x.amount,0);w>0&&(u*=f.amount/w)}u>.01&&(i.push({path:l.addresses,amount:u,percentage:u/l.transactions[0].amount*100}),a+=u)});const c=t.filter(l=>l.to===e).reduce((l,u)=>l+u.amount,0),d=c>0?a/c*100:0;return{sourceAddress:n,targetAddress:e,totalTainted:a,taintPercentage:d,paths:i.sort((l,u)=>u.amount-l.amount).slice(0,20),hops:o}},Je=(t,n)=>{const e=[],o=t.filter(s=>s.from===n||s.to===n).sort((s,c)=>s.date.getTime()-c.date.getTime());if(o.length===0)return e;const r=new Map;o.forEach(s=>{const c=s.date.toISOString().split("T")[0];r.has(c)||r.set(c,[]),r.get(c).push(s)}),r.forEach((s,c)=>{const d=s.reduce((p,h)=>p+h.amount,0);let l="transfer",u=.5;s.length>10&&(l="spike",u=Math.min(s.length/50,1));const m=s.filter(p=>p.to===n),f=s.filter(p=>p.from===n);m.length>5&&f.length<=1?(l="aggregation",u=.8):m.length<=1&&f.length>5&&(l="split",u=.8),e.push({timestamp:new Date(c),type:l,address:n,amount:d,relatedAddresses:Array.from(new Set(s.map(p=>p.from===n?p.to:p.from))),significance:u})});const i=e.sort((s,c)=>s.timestamp.getTime()-c.timestamp.getTime()),a=[];for(let s=1;s<i.length;s++){const c=i[s].timestamp.getTime()-i[s-1].timestamp.getTime(),d=c/(1e3*60*60*24);d>7&&a.push({timestamp:new Date(i[s-1].timestamp.getTime()+c/2),type:"dormant",address:n,amount:0,relatedAddresses:[],significance:Math.min(d/30,1)})}return[...e,...a].sort((s,c)=>s.timestamp.getTime()-c.timestamp.getTime())},Ye=t=>{const n=new Set;return t.forEach(e=>{n.add(e.from),n.add(e.to)}),Array.from(n).sort()},Qe=(t,n)=>{const e=t.filter(h=>h.to===n),o=t.filter(h=>h.from===n),r=[...e,...o].sort((h,w)=>h.date.getTime()-w.date.getTime()),i=e.reduce((h,w)=>h+w.amount,0),a=o.reduce((h,w)=>h+w.amount,0),s=new Map;e.forEach(h=>{const w=s.get(h.from)||{volume:0,count:0};s.set(h.from,{volume:w.volume+h.amount,count:w.count+1})}),o.forEach(h=>{const w=s.get(h.to)||{volume:0,count:0};s.set(h.to,{volume:w.volume+h.amount,count:w.count+1})});const c=Array.from(s.entries()).map(([h,w])=>({address:h,volume:w.volume,count:w.count})).sort((h,w)=>w.volume-h.volume).slice(0,10),d=new Map;r.forEach(h=>{const w=h.date.getHours();d.set(w,(d.get(w)||0)+1)});let l=0,u=0;d.forEach((h,w)=>{h>u&&(u=h,l=w)});const m=r.length,f=i+a,p=Math.min(100,m*2+Math.log10(f+1)*10);return{address:n,totalInflow:i,totalOutflow:a,netBalance:i-a,inflowCount:e.length,outflowCount:o.length,totalTxCount:m,avgInflowSize:e.length>0?i/e.length:0,avgOutflowSize:o.length>0?a/o.length:0,firstTxDate:r.length>0?r[0].date:new Date,lastTxDate:r.length>0?r[r.length-1].date:new Date,topCounterparties:c,peakActivityHour:l,activityScore:p}},Ze=(t,n,e="daily")=>{const o=new Map,r=i=>{if(e==="daily")return i.toISOString().split("T")[0];if(e==="weekly"){const a=new Date(i),s=a.getDay(),c=a.getDate()-s;return new Date(a.setDate(c)).toISOString().split("T")[0]}else return`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`};return t.forEach(i=>{const a=r(i.date),s=o.get(a)||{inflow:0,outflow:0,inflowCount:0,outflowCount:0};i.to===n?(s.inflow+=i.amount,s.inflowCount+=1):i.from===n&&(s.outflow+=i.amount,s.outflowCount+=1),o.set(a,s)}),Array.from(o.entries()).map(([i,a])=>({date:i,inflow:a.inflow,outflow:a.outflow,netFlow:a.inflow-a.outflow,inflowCount:a.inflowCount,outflowCount:a.outflowCount})).sort((i,a)=>i.date.localeCompare(a.date))},de=()=>{const t=_.useCallback(async n=>{var i;const e=n.target,o=(i=e==null?void 0:e.closest)==null?void 0:i.call(e,".copyable");if(!o)return;const r=o.dataset.copy;if(r)try{await navigator.clipboard.writeText(r),o.classList.add("copied"),setTimeout(()=>{o.classList.remove("copied")},1500)}catch(a){console.error("Failed to copy:",a)}},[]);_.useEffect(()=>(document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}),[t])},k=g.jsx("div",{className:"flex items-center justify-center w-full h-full min-h-[100px]",children:g.jsx(G,{className:"w-6 h-6 text-white/50 animate-spin"})}),me=A(()=>M(()=>import("./components/fileupload-9s_BLtel.js"),__vite__mapDeps([0,1,2]),import.meta.url),{fallback:k}),he=A(()=>M(()=>import("./components/summarystats-InDTjXKm.js"),__vite__mapDeps([3,1]),import.meta.url),{fallback:k}),fe=A(()=>M(()=>import("./components/chartssection-CshOC2K6.js"),__vite__mapDeps([4,1]),import.meta.url),{fallback:k}),pe=A(()=>M(()=>import("./components/transactiontable-DR116WtF.js"),__vite__mapDeps([5,1]),import.meta.url),{fallback:k}),ge=A(()=>M(()=>import("./components/moneyflow-CKbXzbY5.js"),__vite__mapDeps([6,1]),import.meta.url),{fallback:k}),we=A(()=>M(()=>import("./components/unifiedgraph-w_4yEjFQ.js"),__vite__mapDeps([7,1,5]),import.meta.url),{fallback:k}),ye=A(()=>M(()=>import("./components/forensicsdashboard-H2KHPed7.js"),__vite__mapDeps([8,1]),import.meta.url),{fallback:k}),xe=A(()=>M(()=>import("./components/pathfinder-Cu_LyH2U.js"),__vite__mapDeps([9,1]),import.meta.url),{fallback:k}),be=A(()=>M(()=>import("./components/timelinetracer-Co6Zd89z.js"),__vite__mapDeps([10,1]),import.meta.url),{fallback:k});A(()=>M(()=>import("./components/taintchart-B-g6fgxl.js"),__vite__mapDeps([11,1,12,13]),import.meta.url),{fallback:k});const Se=A(()=>M(()=>import("./components/walletanalysis-D65TPafM.js"),__vite__mapDeps([14,1]),import.meta.url),{fallback:k}),ve=A(()=>M(()=>import("./components/index-1qNSQp_h.js"),__vite__mapDeps([15,1]),import.meta.url),{fallback:k}),Te=()=>{de();const[t,n]=_.useState([]),[e,o]=_.useState("overview"),[r,i]=_.useState(new Set(["overview"])),a=l=>{n(l),o("overview"),i(new Set(["overview"]))};_.useEffect(()=>{t.length>0&&i(l=>{const u=new Set(l);return u.add(e),u})},[e,t]);const s=_.useMemo(()=>ie(t),[t]),c=_.useMemo(()=>ce(t),[t]),d=[{id:"overview",label:"Dashboard",icon:X},{id:"arkham",label:"Arkham Tracer",icon:J},{id:"money-flow",label:"Money Flow Analysis",icon:U},{id:"transactions",label:"Transactions",icon:Y},{id:"wallet-analysis",label:"Wallet Analysis",icon:Q},{id:"interactive",label:"Interactive Graph",icon:Z},{id:"path-finder",label:"Path Finder",icon:ee},{id:"timeline",label:"Timeline Tracer",icon:te},{id:"forensics",label:"Forensics Suite",icon:se}];return g.jsxs("div",{className:"min-h-screen bg-slate-950 text-slate-100 font-sans flex flex-col",children:[g.jsxs("header",{className:"border-b border-slate-800 bg-slate-950/80 backdrop-blur",children:[g.jsxs("div",{className:"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center shadow-lg shadow-indigo-500/20",children:g.jsx(U,{className:"w-5 h-5 text-white"})}),g.jsx("span",{className:"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400",children:"CryptoFlow"})]}),t.length>0&&g.jsx("button",{onClick:()=>n([]),className:"text-xs font-medium text-slate-400 hover:text-white transition-colors border border-slate-800 px-3 py-1.5 rounded bg-slate-900",children:"Reset Data"})]}),t.length>0&&g.jsx("div",{className:"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 mt-2 overflow-x-auto",children:g.jsx("nav",{className:"flex space-x-1 border-b border-slate-800/50 pb-0","aria-label":"Tabs",children:d.map(l=>{const u=e===l.id;return g.jsxs("button",{onClick:()=>o(l.id),className:`
                      flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap
                      ${u?"border-indigo-500 text-indigo-400":"border-transparent text-slate-400 hover:text-slate-200 hover:border-slate-700"}
                    `,children:[g.jsx(l.icon,{className:`w-4 h-4 ${u?"text-indigo-400":"text-slate-500"}`}),l.label]},l.id)})})})]}),g.jsx("main",{className:`flex-1 max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 w-full ${e==="interactive"?"py-4":"py-8"}`,children:t.length===0?g.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[80vh]",children:[g.jsxs("div",{className:"text-center mb-8",children:[g.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 via-purple-400 to-emerald-400",children:"Visualize Money Flow"}),g.jsx("p",{className:"text-slate-400 max-w-lg mx-auto text-lg",children:"Upload your transaction ledger to instantly generate interactive flow graphs, volume analytics, and wallet statistics."})]}),g.jsx(me,{onDataLoaded:a})]}):g.jsxs("div",{className:"animate-fade-in h-full relative",children:[g.jsx("div",{style:{display:e==="overview"?"block":"none"},children:g.jsxs("div",{className:"space-y-8",children:[g.jsx(he,{summary:s}),g.jsx(fe,{dailyData:c})]})}),g.jsx("div",{style:{display:e==="interactive"?"block":"none"},className:"h-full",children:r.has("interactive")&&g.jsx(we,{transactions:t,initialAddress:s.topAddress})}),g.jsx("div",{style:{display:e==="money-flow"?"block":"none"},className:"h-full",children:r.has("money-flow")&&g.jsx(ge,{transactions:t})}),g.jsx("div",{style:{display:e==="forensics"?"block":"none"},className:"h-full",children:r.has("forensics")&&g.jsx(ye,{transactions:t})}),g.jsx("div",{style:{display:e==="path-finder"?"block":"none"},className:"h-full",children:r.has("path-finder")&&g.jsx(xe,{transactions:t})}),g.jsx("div",{style:{display:e==="timeline"?"block":"none"},className:"h-full",children:r.has("timeline")&&g.jsx(be,{transactions:t})}),g.jsx("div",{style:{display:e==="wallet-analysis"?"block":"none"},className:"h-full",children:r.has("wallet-analysis")&&g.jsx(Se,{transactions:t})}),g.jsx("div",{style:{display:e==="transactions"?"block":"none"},className:"h-full",children:r.has("transactions")&&g.jsx(pe,{transactions:t})}),g.jsx("div",{style:{display:e==="arkham"?"block":"none"},className:"h-full",children:r.has("arkham")&&g.jsx(ve,{transactions:t})})]})}),g.jsx("footer",{className:"border-t border-slate-900 mt-auto py-8 text-center",children:g.jsx("p",{className:"text-slate-600 text-sm",children:"CryptoFlow Analytics • Local processing only"})})]})},z=document.getElementById("root");if(!z)throw new Error("Could not find root element to mount to");const _e=oe.createRoot(z);_e.render(g.jsx(ne.StrictMode,{children:g.jsx(Te,{})}));const et=(()=>{const t=[],n=new Date,e=["Binance_Hot_Wallet","Coinbase_Prime","OKX_Reserves","Kraken_Deposit","Huobi_Global"],o=["Uniswap_V3_USDT_ETH","Curve_3pool","Aave_Lending_Pool","Stargate_Bridge_USDT"],r=["Wintermute_Trading","Jump_Crypto","GSR_Markets"],i="Tornado_Cash_Router",a=Array.from({length:20},(d,l)=>`0xWhale_${l.toString().padStart(2,"0")}`),s=Array.from({length:1e3},(d,l)=>`0x${Math.floor(Math.random()*1e5).toString(16).padStart(4,"0")}`),c=(d,l,u,m)=>{const f=new Date(n);f.setHours(f.getHours()-m),f.setMinutes(f.getMinutes()+Math.floor(Math.random()*60)),t.push({id:`tx_${Math.random().toString(36).substr(2,9)}`,date:f,from:d,to:l,amount:parseFloat(u.toFixed(2)),currency:"USDT",type:"transfer"})};for(let d=0;d<2e3;d++){const l=e[Math.floor(Math.random()*e.length)],u=s[Math.floor(Math.random()*s.length)],m=Math.random()>.4,f=Math.random()*5e3+100,p=Math.floor(Math.random()*24*90);m?c(u,l,f,p):c(l,u,f*.9,p)}for(let d=0;d<200;d++){const l=a[Math.floor(Math.random()*a.length)],u=e[Math.floor(Math.random()*e.length)],m=Math.random()*5e5+5e4,f=Math.floor(Math.random()*24*90);Math.random()>.5?c(l,u,m,f):c(u,l,m,f)}for(let d=0;d<100;d++){const l=r[Math.floor(Math.random()*r.length)],u=e[Math.floor(Math.random()*e.length)],m=o[Math.floor(Math.random()*o.length)],f=Math.random()*1e5+1e4,p=Math.floor(Math.random()*24*30);c(l,u,f,p+4),c(u,m,f*.99,p+3),c(m,l,f*1.01,p+2)}for(let d=0;d<50;d++){const l=s[Math.floor(Math.random()*100)],u=`0xMule_${Math.random().toString(16).substr(2,4)}`,m=`0xMule_${Math.random().toString(16).substr(2,4)}`,f=e[0],p=2e4,h=Math.floor(Math.random()*24*10);c(l,u,p,h+5),c(u,m,p*.98,h+4),c(m,i,p*.96,h+3),c(i,f,p*.9,h+1)}for(let d=0;d<300;d++){const l=s[Math.floor(Math.random()*s.length)],u="Stargate_Bridge_USDT",m=Math.random()*2e3,f=Math.floor(Math.random()*24*60);c(l,u,m,f)}return t.sort((d,l)=>l.date.getTime()-d.date.getTime())})(),Ce="cryptoflow_cache",Ae=1,C="wallet_transactions",Me=1440*60*1e3;function I(){return new Promise((t,n)=>{const e=indexedDB.open(Ce,Ae);e.onerror=()=>n(e.error),e.onsuccess=()=>t(e.result),e.onupgradeneeded=o=>{const r=o.target.result;if(!r.objectStoreNames.contains(C)){const i=r.createObjectStore(C,{keyPath:["address","chain","tokenContract"]});i.createIndex("address","address",{unique:!1}),i.createIndex("chain","chain",{unique:!1}),i.createIndex("timestamp","timestamp",{unique:!1})}}})}function q(t,n,e){return[t.toLowerCase(),n,e||"all"]}async function ke(t,n,e=null){try{const i=(await I()).transaction(C,"readonly").objectStore(C),a=q(t,n,e),s=i.get(a);return new Promise(c=>{s.onsuccess=()=>{const d=s.result;d&&d.expiresAt>Date.now()?c(d.transactions):c(null)},s.onerror=()=>c(null)})}catch{return null}}async function De(t,n,e,o,r=Me){try{const a=(await I()).transaction(C,"readwrite"),s=a.objectStore(C),c=Date.now(),d={address:t.toLowerCase(),chain:n,tokenContract:e||"all",transactions:o,timestamp:c,expiresAt:c+r};return s.put(d),new Promise((l,u)=>{a.oncomplete=()=>l(),a.onerror=()=>u(a.error)})}catch(i){console.error("Failed to cache transactions:",i)}}async function tt(t,n){try{const o=(await I()).transaction(C,"readwrite"),r=o.objectStore(C),a=r.index("address").getAll(t.toLowerCase());let s=0;return new Promise(c=>{a.onsuccess=()=>{const d=a.result;for(const l of d)if(!n||l.chain===n){const u=q(l.address,l.chain,l.tokenContract);r.delete(u),s++}o.oncomplete=()=>c(s)},a.onerror=()=>c(0)})}catch{return 0}}async function st(){try{const n=(await I()).transaction(C,"readwrite");return n.objectStore(C).clear(),new Promise((o,r)=>{n.oncomplete=()=>o(),n.onerror=()=>r(n.error)})}catch(t){console.error("Failed to clear cache:",t)}}async function ot(){try{const o=(await I()).transaction(C,"readonly").objectStore(C).getAll();return new Promise(r=>{o.onsuccess=()=>{const i=o.result,a=Date.now(),s=i.filter(l=>l.expiresAt>a),c=JSON.stringify(i).length,d=c>1024*1024?`${(c/(1024*1024)).toFixed(2)} MB`:`${(c/1024).toFixed(2)} KB`;r({totalEntries:s.length,totalSize:d,entries:s.map(l=>({address:l.address,chain:l.chain,txCount:l.transactions.length,cachedAt:new Date(l.timestamp),expiresAt:new Date(l.expiresAt)}))})},o.onerror=()=>r({totalEntries:0,totalSize:"0 KB",entries:[]})})}catch{return{totalEntries:0,totalSize:"0 KB",entries:[]}}}const Ee="https://deep-index.moralis.io/api/v2.2",je={bsc:"0x38",eth:"0x1",polygon:"0x89",arbitrum:"0xa4b1",base:"0x2105",optimism:"0xa"},F={bsc:{name:"BNB Smart Chain",symbol:"BSC",chainId:56,explorerUrl:"https://bscscan.com",usdtContract:"0x55d398326f99059fF775485246999027B3197955"},eth:{name:"Ethereum",symbol:"ETH",chainId:1,explorerUrl:"https://etherscan.io",usdtContract:"0xdAC17F958D2ee523a2206206994597C13D831ec7"},polygon:{name:"Polygon",symbol:"MATIC",chainId:137,explorerUrl:"https://polygonscan.com",usdtContract:"0xc2132D05D31c914a87C6611C10748AEb04B58e8F"},arbitrum:{name:"Arbitrum One",symbol:"ARB",chainId:42161,explorerUrl:"https://arbiscan.io",usdtContract:"0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9"},base:{name:"Base",symbol:"BASE",chainId:8453,explorerUrl:"https://basescan.org",usdtContract:void 0},optimism:{name:"Optimism",symbol:"OP",chainId:10,explorerUrl:"https://optimistic.etherscan.io",usdtContract:"0x94b008aA00579c1307B0EF2c499aD98a8ce58e58"}};class nt{constructor(){this._isPaused=!1,this._isStopped=!1,this._pausePromise=null,this._pauseResolve=null}get isPaused(){return this._isPaused}get isStopped(){return this._isStopped}pause(){!this._isPaused&&!this._isStopped&&(this._isPaused=!0,this._pausePromise=new Promise(n=>{this._pauseResolve=n}))}resume(){this._isPaused&&(this._isPaused=!1,this._pauseResolve&&(this._pauseResolve(),this._pauseResolve=null,this._pausePromise=null))}stop(){this._isStopped=!0,this.resume()}reset(){this._isPaused=!1,this._isStopped=!1,this._pausePromise=null,this._pauseResolve=null}async waitIfPaused(){this._pausePromise&&await this._pausePromise}}class Pe{constructor(n){this.queue=[],this.processing=!1,this.lastCall=0,this.minInterval=1e3/n}async schedule(n){return new Promise((e,o)=>{this.queue.push(async()=>{try{const r=await n();e(r)}catch(r){o(r)}}),this.process()})}async process(){if(!this.processing){for(this.processing=!0;this.queue.length>0;){const e=Date.now()-this.lastCall;e<this.minInterval&&await new Promise(r=>setTimeout(r,this.minInterval-e)),this.lastCall=Date.now();const o=this.queue.shift();o&&await o()}this.processing=!1}}}const Le=new Pe(5),$=new Set;function Ie(t){return t.split(/[\n,;]/).map(n=>n.trim()).filter(n=>n.length>0)}const Re=10,$e=1e3;async function Fe(t,n,e,o,r,i,a){const s=je[e];if(!s)throw new Error(`Chain ${e} not supported by Moralis`);const c=(a==null?void 0:a.maxPages)??Re,d=(a==null?void 0:a.maxTransactions)??$e,l=[];let u=null,m=0;do{const f=new URLSearchParams({chain:s,order:"ASC",limit:"100"});if(o&&f.set("contract_addresses",o),r){const y=new Date(r).toISOString();f.set("from_date",y)}if(i){const y=new Date(i).toISOString();f.set("to_date",y)}u&&f.set("cursor",u);const p=`${Ee}/${t}/erc20/transfers?${f}`,h=await fetch(p,{headers:{"X-API-Key":n,Accept:"application/json"}});if(!h.ok){const y=await h.text();throw(h.status===429||h.status===401)&&($.add(n),console.warn(`API key ${n.slice(0,8)}... marked as failed (status ${h.status})`)),new Error(`Moralis API error: ${h.status} - ${y}`)}const w=await h.json(),S=w.result||[],x=S.map(y=>({hash:y.transaction_hash,from:y.from_address,to:y.to_address,value:y.value,tokenDecimal:y.token_decimals||"18",tokenSymbol:y.token_symbol||"UNKNOWN",timeStamp:(new Date(y.block_timestamp).getTime()/1e3).toString(),blockNumber:y.block_number,contractAddress:y.address}));if(l.push(...x),m++,u=w.cursor||null,(m>1||u)&&console.log(`[${t.slice(0,8)}...] Page ${m}: ${S.length} transfers (total: ${l.length})${u?", more available":", done"}`),m>=c){console.log(`[${t.slice(0,8)}...] Reached max pages limit (${c})`);break}if(l.length>=d){console.log(`[${t.slice(0,8)}...] Reached max transactions limit (${d})`),l.length=d;break}u&&await new Promise(y=>setTimeout(y,100))}while(u);return l}async function K(t,n,e="bsc",o,r,i,a){if(!F[e])throw new Error(`Unknown chain: ${e}`);const c=Ie(n);if(c.length===0)throw new Error("Moralis API key required. Get a free key at: https://moralis.com");const d=c.filter(m=>!$.has(m)),l=d.length>0?d:c;d.length===0&&(console.log("All keys previously failed, resetting failed keys list..."),$.clear());let u=null;for(const m of l)try{return console.log(`Trying API key ${m.slice(0,8)}... (${l.indexOf(m)+1}/${l.length})`),await Fe(t,m,e,o,r,i,a)}catch(f){u=f,console.warn(`API key ${m.slice(0,8)}... failed:`,f.message)}throw new Error(`All ${l.length} API keys failed. Last error: ${u==null?void 0:u.message}`)}async function Oe(t,n,e="bsc",o,r,i){const a=F[e];return K(t,n,e,a.usdtContract,o,r,i)}function V(t,n="bsc"){const e=parseInt(t.tokenDecimal)||18,o=parseFloat(t.value)/Math.pow(10,e);return{id:t.hash,date:new Date(parseInt(t.timeStamp)*1e3),from:t.from.toLowerCase(),to:t.to.toLowerCase(),amount:o,currency:t.tokenSymbol||"USDT",type:"transfer"}}async function W(t,n,e="bsc",o=!0,r=!0,i,a,s){const c=F[e],d=o&&c.usdtContract||null;if(r&&!i&&!a){const l=await ke(t,e,d);if(l)return l.map(u=>V(u,e))}return Le.schedule(async()=>{const l=o?await Oe(t,n,e,i,a,s):await K(t,n,e,void 0,i,a,s);return r&&l.length>=0&&!i&&!a&&await De(t,e,d,l),l.map(u=>V(u,e))})}async function at(t,n,e={}){const{chain:o="bsc",usdtOnly:r=!0,useCache:i=!0,controller:a,onProgress:s,startLayer:c=1,fromDate:d,toDate:l,maxPages:u,maxTransactions:m}=e,f={maxPages:u,maxTransactions:m},p=[...new Set(t.map(b=>b.toLowerCase().trim()))],h=[],w=new Map,S=new Map;let x=0,y=0,v=!1;w.set(c,p),p.forEach(b=>S.set(b,c));for(const b of p){if(a!=null&&a.isStopped){v=!0;break}if(a!=null&&a.isPaused&&(s==null||s({address:b,layer:c,status:"paused",transactions:[]}),await a.waitIfPaused()),a!=null&&a.isStopped){v=!0;break}const T={address:b,layer:c,status:"loading",transactions:[]};s==null||s(T);try{const E=await W(b,n,o,r,i,d,l,f);h.push(...E),x++,T.status="success",T.transactions=E,s==null||s(T)}catch(E){y++,T.status="error",T.error=E.message,s==null||s(T)}}return{totalAddresses:p.length,successCount:x,errorCount:y,allTransactions:h,layerMap:w,addressToLayer:S,wasStopped:v}}async function rt(t,n,e={}){const{chain:o="bsc",usdtOnly:r=!0,useCache:i=!0,controller:a,maxLayers:s=3,onProgress:c,onLayerComplete:d,fromDate:l,toDate:u,maxPages:m,maxTransactions:f}=e,p={maxPages:m,maxTransactions:f},h=[],w=new Map,S=new Map,x=new Set;let y=0,v=0,b=!1,T=1,E=t.map(j=>j.toLowerCase().trim());for(;T<=s&&E.length>0;){if(a!=null&&a.isStopped){b=!0;break}const j=E.filter(D=>!x.has(D));if(j.length===0)break;w.set(T,j),j.forEach(D=>{S.set(D,T),x.add(D)});const O=new Set;for(const D of j){if(a!=null&&a.isStopped){b=!0;break}if(a!=null&&a.isPaused&&(c==null||c({address:D,layer:T,status:"paused",transactions:[]}),await a.waitIfPaused()),a!=null&&a.isStopped){b=!0;break}const P={address:D,layer:T,status:"loading",transactions:[]};c==null||c(P);try{const L=await W(D,n,o,r,i,l,u,p);h.push(...L),y++,L.filter(R=>R.from.toLowerCase()===D).forEach(R=>{const N=R.to.toLowerCase();x.has(N)||O.add(N)}),P.status="success",P.transactions=L,c==null||c(P)}catch(L){v++,P.status="error",P.error=L.message,c==null||c(P)}}if(b)break;d==null||d(T,j),T++,E=Array.from(O)}return{totalAddresses:x.size,successCount:y,errorCount:v,allTransactions:h,layerMap:w,addressToLayer:S,wasStopped:b}}function Ne(t){return/^0x[a-fA-F0-9]{40}$/.test(t)}function it(t){const n=t.split(/[\n,;]/).map(e=>e.trim().toLowerCase()).filter(e=>e.length>0).filter(Ne);return[...new Set(n)]}function ct(t,n){const e=new Set(n.map(i=>i.toLowerCase())),o=new Map,r=t.filter(i=>e.has(i.from.toLowerCase()));for(const i of r){const a=i.to.toLowerCase();if(e.has(a))continue;o.has(a)||o.set(a,{address:a,layer:2,totalReceived:0,totalSent:0,netFlow:0,incomingTxCount:0,outgoingTxCount:0,sourceAddresses:new Set,destinationAddresses:new Set});const s=o.get(a);s.totalReceived+=i.amount,s.incomingTxCount++,s.sourceAddresses.add(i.from.toLowerCase()),s.netFlow=s.totalReceived-s.totalSent}return Array.from(o.values()).sort((i,a)=>a.totalReceived-i.totalReceived)}function lt(t,n="flow_analysis.csv"){const e=["Address","Layer","Total Received","Total Sent","Net Flow","Incoming TX Count","Outgoing TX Count","Source Count","Destination Count"],o=t.map(c=>[c.address,c.layer.toString(),c.totalReceived.toFixed(6),c.totalSent.toFixed(6),c.netFlow.toFixed(6),c.incomingTxCount.toString(),c.outgoingTxCount.toString(),c.sourceAddresses.size.toString(),c.destinationAddresses.size.toString()]),r=[e,...o].map(c=>c.join(",")).join(`
`),i=new Blob([r],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(i),s=document.createElement("a");return s.setAttribute("href",a),s.setAttribute("download",n),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),r}const ut=(t,n=6,e=4)=>t.length<=n+e?t:`${t.slice(0,n)}...${t.slice(-e)}`,dt=t=>t>=1e6?`$${(t/1e6).toFixed(1)}M`:t>=1e3?`$${(t/1e3).toFixed(1)}K`:`$${t.toFixed(0)}`,mt=t=>{const e=new Date().getTime()-t.getTime(),o=Math.floor(e/1e3),r=Math.floor(o/60),i=Math.floor(r/60),a=Math.floor(i/24),s=Math.floor(a/7),c=Math.floor(a/30),d=Math.floor(a/365);return d>0?`${d}y ago`:c>0?`${c}mo ago`:s>0?`${s}w ago`:a>0?`${a}d ago`:i>0?`${i}h ago`:r>0?`${r}m ago`:"just now"},ht=()=>{const[t,n]=_.useState(!1),e=_.useRef(null),o=_.useRef(new Map);return _.useEffect(()=>{try{e.current=new Worker(new URL(""+new URL("forensics.worker-CDTmhihb.js",import.meta.url).href,import.meta.url),{type:"module"}),n(!0),e.current.onmessage=i=>{const{type:a,requestId:s,data:c,error:d}=i.data,l=o.current.get(s);l&&(a==="SUCCESS"?l(c):a==="ERROR"&&(console.error("Forensics Worker error:",d),l(null)),o.current.delete(s))},e.current.onerror=i=>{console.error("Worker error:",i)}}catch(i){console.error("Failed to initialize forensics worker:",i)}return()=>{var i;(i=e.current)==null||i.terminate(),o.current.clear()}},[]),{executeTask:_.useCallback(i=>new Promise(a=>{if(!e.current){console.warn("Worker not initialized, returning null"),a(null);return}const s=`req_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;o.current.set(s,a);const c={...i,requestId:s};e.current.postMessage(c)}),[]),isReady:t}};class H{constructor(n=50,e=30){this.cache=new Map,this.currentSize=0,this.maxSize=n*1024*1024,this.ttl=e*60*1e3}set(n,e){const o=JSON.stringify(e).length*2;for(;this.currentSize+o>this.maxSize&&this.cache.size>0;)this.evictOldest();const r=this.cache.get(n);r&&(this.currentSize-=r.size),this.cache.set(n,{data:e,timestamp:Date.now(),size:o}),this.currentSize+=o}get(n){const e=this.cache.get(n);return e?Date.now()-e.timestamp>this.ttl?(this.delete(n),null):e.data:null}delete(n){const e=this.cache.get(n);e&&(this.currentSize-=e.size,this.cache.delete(n))}evictOldest(){let n=null,e=1/0;this.cache.forEach((o,r)=>{o.timestamp<e&&(e=o.timestamp,n=r)}),n&&this.delete(n)}clear(){this.cache.clear(),this.currentSize=0}stats(){return{entries:this.cache.size,sizeMB:(this.currentSize/(1024*1024)).toFixed(2),maxSizeMB:(this.maxSize/(1024*1024)).toFixed(2),utilization:(this.currentSize/this.maxSize*100).toFixed(1)+"%"}}has(n){return this.cache.has(n)&&this.get(n)!==null}}const ft=new H(20,30),pt=new H(10,30),gt=(t,n)=>{const e=Object.keys(n).sort().map(o=>`${o}:${JSON.stringify(n[o])}`).join("|");return`${t}_${e}`},Ue=t=>{const n=["Path","Hops","Total Amount","Suspicion Score","Start Date","End Date","Avg Delay (hours)"],e=t.map(o=>[o.addresses.join(" → "),o.hops.toString(),o.totalAmount.toFixed(2),o.suspicionScore.toFixed(1),o.startDate.toISOString(),o.endDate.toISOString(),(o.avgDelay/36e5).toFixed(2)]);return[n.join(","),...e.map(o=>o.map(r=>`"${r}"`).join(","))].join(`
`)},Be=t=>JSON.stringify({generatedAt:new Date().toISOString(),version:"1.0",application:"CryptoFlow Analytics",...t},null,2),Ve=t=>{const n=["Type","Severity","Score","Description","Affected Addresses Count","Transactions Count"],e=t.map(o=>[o.type,o.severity,o.score.toString(),o.description,o.affectedAddresses.length.toString(),o.transactions.length.toString()]);return[n.join(","),...e.map(o=>o.map(r=>`"${r}"`).join(","))].join(`
`)},ze=t=>{const n=["Source","Target","Total Tainted","Taint Percentage","Path","Path Amount","Path Percentage"],e=t.paths.map(o=>[t.sourceAddress,t.targetAddress,t.totalTainted.toFixed(2),t.taintPercentage.toFixed(2),o.path.join(" → "),o.amount.toFixed(2),o.percentage.toFixed(2)]);return[n.join(","),...e.map(o=>o.map(r=>`"${r}"`).join(","))].join(`
`)},qe=t=>{const n=["Cluster ID","Address Count","Common Behavior","Total Volume","Transaction Count","Confidence Score"],e=t.map(o=>[o.clusterId,o.addresses.length.toString(),o.commonBehavior,o.totalVolume.toFixed(2),o.transactionCount.toString(),o.confidenceScore.toFixed(2)]);return[n.join(","),...e.map(o=>o.map(r=>`"${r}"`).join(","))].join(`
`)},Ke=(t,n)=>{const e=URL.createObjectURL(t),o=document.createElement("a");o.href=e,o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(e)},wt=(t,n,e)=>{let o,r,i;switch(n){case"paths":o=Ue(t),r="csv",i="text/csv";break;case"patterns":o=Ve(t),r="csv",i="text/csv";break;case"taint":o=ze(t),r="csv",i="text/csv";break;case"clusters":o=qe(t),r="csv",i="text/csv";break;case"json":default:o=Be(t),r="json",i="application/json";break}const a=new Blob([o],{type:`${i};charset=utf-8`}),s=`cryptoflow-${n}-${new Date().toISOString().split("T")[0]}.${r}`;Ke(a,e||s)};export{F as C,k as L,et as S,M as _,ut as a,ft as b,ze as c,Je as d,wt as e,dt as f,gt as g,Ye as h,Qe as i,Ze as j,Xe as k,mt as l,it as m,nt as n,at as o,pt as p,ct as q,Ie as r,rt as s,lt as t,ht as u,ot as v,tt as w,st as x,Ge as y};
