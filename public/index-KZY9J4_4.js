const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./components/fileupload-ZCVGXnrx.js","./vendor-Cs9IRPBE.js","./components/walletscanner-m3Un0ADd.js","./components/summarystats-x00y4ZEX.js","./components/chartssection-CPZAYBNR.js","./components/transactiontable-CTGP1dwp.js","./components/moneyflow-BgTnNw7G.js","./components/unifiedgraph-BQqJQMAc.js","./components/forensicsdashboard-DL47B_5k.js","./components/pathfinder-CK4y3YSD.js","./components/timelinetracer-QpXQU-0a.js","./components/taintchart-CVy2QCuo.js","./components/loadingspinner-CzkEJp2V.js","./components/exportbutton-JQimFbMy.js","./components/walletanalysis-BhhFyVVL.js","./components/index-v6NW1_nW.js"])))=>i.map(i=>d[i]);
import{r as _,j as g,H as J,n as A,az as B,aA as X,w as Y,ah as Q,I as Z,N as ee,Q as te,g as oe,o as se,aB as ne,ae as re}from"./vendor-Cs9IRPBE.js";import"./index-KZY9J4_4.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function e(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=e(a);fetch(a.href,r)}})();function Ge(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}const ae="modulepreload",ie=function(t,n){return new URL(t,n).href},z={},k=function(n,e,o){let a=Promise.resolve();if(e&&e.length>0){let i=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};const s=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),d=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));a=i(e.map(l=>{if(l=ie(l,o),l in z)return;z[l]=!0;const u=l.endsWith(".css"),m=u?'[rel="stylesheet"]':"";if(!!o)for(let f=s.length-1;f>=0;f--){const w=s[f];if(w.href===l&&(!u||w.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${m}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":ae,u||(h.as="script"),h.crossOrigin="",h.href=l,d&&h.setAttribute("nonce",d),document.head.appendChild(h),u)return new Promise((f,w)=>{h.addEventListener("load",f),h.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(i){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=i,window.dispatchEvent(s),!s.defaultPrevented)throw i}return a.then(i=>{for(const s of i||[])s.status==="rejected"&&r(s.reason);return n().catch(r)})},ce=t=>{if(t.length===0)return{totalVolume:0,transactionCount:0,uniqueAddresses:0,avgTransactionValue:0,maxTransactionValue:0,startDate:new Date,endDate:new Date,topAddress:""};const n=t.reduce((s,c)=>s+c.amount,0),e=new Map;t.forEach(s=>{e.set(s.from,(e.get(s.from)||0)+s.amount),e.set(s.to,(e.get(s.to)||0)+s.amount)});let o="",a=0;e.forEach((s,c)=>{s>a&&(a=s,o=c)});const r=Math.max(...t.map(s=>s.amount)),i=t.map(s=>s.date.getTime());return{totalVolume:n,transactionCount:t.length,uniqueAddresses:e.size,avgTransactionValue:n/t.length,maxTransactionValue:r,startDate:new Date(Math.min(...i)),endDate:new Date(Math.max(...i)),topAddress:o}},le=t=>{const n=new Map;return t.forEach(e=>{const o=e.date.toISOString().split("T")[0],a=n.get(o)||{volume:0,count:0};n.set(o,{volume:a.volume+e.amount,count:a.count+1})}),Array.from(n.entries()).map(([e,o])=>({date:e,...o})).sort((e,o)=>e.date.localeCompare(o.date))},ue=t=>{if(t.length===0)return 0;let n=0;const o=t.filter(s=>{const c=s.amount;return c>=1e3&&c%1e3===0}).length/t.length;n+=o*30;const a=[...t].sort((s,c)=>s.date.getTime()-c.date.getTime());let r=0;for(let s=1;s<a.length;s++)a[s].date.getTime()-a[s-1].date.getTime()<300*1e3&&r++;a.length>1&&(n+=r/(a.length-1)*30);const i=Math.min(t.length*3,20);if(n+=i,t.length>1){const s=t.map(m=>m.amount),c=s.reduce((m,p)=>m+p,0)/s.length,d=s.reduce((m,p)=>m+Math.pow(p-c,2),0)/s.length,l=Math.sqrt(d),u=c>0?l/c:1;u<.1?n+=20:u<.3&&(n+=10)}return Math.min(n,100)},de=(t,n,e,o=10,a=100)=>{const r=performance.now(),i=new Map;t.forEach(u=>{i.has(u.from)||i.set(u.from,[]),i.get(u.from).push({tx:u,to:u.to})});const s=[],c=(u,m,p,h,f)=>{if(s.length>=a||f>o)return;if(u===e){const v=h.reduce((C,b)=>C+b.amount,0),x=h.map(C=>C.date.getTime()).sort((C,b)=>C-b),y=x.slice(1).map((C,b)=>C-x[b]);s.push({addresses:[...p,u],transactions:[...h],totalAmount:v,hops:h.length,startDate:new Date(x[0]),endDate:new Date(x[x.length-1]),avgDelay:y.length>0?y.reduce((C,b)=>C+b,0)/y.length:0,suspicionScore:ue(h)});return}const w=i.get(u)||[];for(const{tx:v,to:x}of w)m.has(x)||(m.add(x),c(x,m,[...p,u],[...h,v],f+1),m.delete(x))};c(n,new Set([n]),[],[],0);const l=s.length>0?s.reduce((u,m)=>m.hops<u.hops?m:u,s[0]):null;return{source:n,target:e,paths:s,shortestPath:l,statistics:{totalPathsFound:s.length,avgPathLength:s.length>0?s.reduce((u,m)=>u+m.hops,0)/s.length:0,executionTime:performance.now()-r}}},Je=(t,n,e,o=10)=>{const a=de(t,n,e,o,1e3),r=[];let i=0;a.paths.forEach(l=>{if(l.transactions.length===0)return;let u=l.transactions[0].amount;for(let m=0;m<l.transactions.length;m++){const p=l.transactions[m],h=p.from,w=t.filter(v=>v.from===h&&v.date>=p.date&&v.date<=new Date(p.date.getTime()+1440*60*1e3)).reduce((v,x)=>v+x.amount,0);w>0&&(u*=p.amount/w)}u>.01&&(r.push({path:l.addresses,amount:u,percentage:u/l.transactions[0].amount*100}),i+=u)});const c=t.filter(l=>l.to===e).reduce((l,u)=>l+u.amount,0),d=c>0?i/c*100:0;return{sourceAddress:n,targetAddress:e,totalTainted:i,taintPercentage:d,paths:r.sort((l,u)=>u.amount-l.amount).slice(0,20),hops:o}},Xe=(t,n)=>{const e=[],o=t.filter(s=>s.from===n||s.to===n).sort((s,c)=>s.date.getTime()-c.date.getTime());if(o.length===0)return e;const a=new Map;o.forEach(s=>{const c=s.date.toISOString().split("T")[0];a.has(c)||a.set(c,[]),a.get(c).push(s)}),a.forEach((s,c)=>{const d=s.reduce((h,f)=>h+f.amount,0);let l="transfer",u=.5;s.length>10&&(l="spike",u=Math.min(s.length/50,1));const m=s.filter(h=>h.to===n),p=s.filter(h=>h.from===n);m.length>5&&p.length<=1?(l="aggregation",u=.8):m.length<=1&&p.length>5&&(l="split",u=.8),e.push({timestamp:new Date(c),type:l,address:n,amount:d,relatedAddresses:Array.from(new Set(s.map(h=>h.from===n?h.to:h.from))),significance:u})});const r=e.sort((s,c)=>s.timestamp.getTime()-c.timestamp.getTime()),i=[];for(let s=1;s<r.length;s++){const c=r[s].timestamp.getTime()-r[s-1].timestamp.getTime(),d=c/(1e3*60*60*24);d>7&&i.push({timestamp:new Date(r[s-1].timestamp.getTime()+c/2),type:"dormant",address:n,amount:0,relatedAddresses:[],significance:Math.min(d/30,1)})}return[...e,...i].sort((s,c)=>s.timestamp.getTime()-c.timestamp.getTime())},Ye=t=>{const n=new Set;return t.forEach(e=>{n.add(e.from),n.add(e.to)}),Array.from(n).sort()},Qe=(t,n)=>{const e=t.filter(f=>f.to===n),o=t.filter(f=>f.from===n),a=[...e,...o].sort((f,w)=>f.date.getTime()-w.date.getTime()),r=e.reduce((f,w)=>f+w.amount,0),i=o.reduce((f,w)=>f+w.amount,0),s=new Map;e.forEach(f=>{const w=s.get(f.from)||{volume:0,count:0};s.set(f.from,{volume:w.volume+f.amount,count:w.count+1})}),o.forEach(f=>{const w=s.get(f.to)||{volume:0,count:0};s.set(f.to,{volume:w.volume+f.amount,count:w.count+1})});const c=Array.from(s.entries()).map(([f,w])=>({address:f,volume:w.volume,count:w.count})).sort((f,w)=>w.volume-f.volume).slice(0,10),d=new Map;a.forEach(f=>{const w=f.date.getHours();d.set(w,(d.get(w)||0)+1)});let l=0,u=0;d.forEach((f,w)=>{f>u&&(u=f,l=w)});const m=a.length,p=r+i,h=Math.min(100,m*2+Math.log10(p+1)*10);return{address:n,totalInflow:r,totalOutflow:i,netBalance:r-i,inflowCount:e.length,outflowCount:o.length,totalTxCount:m,avgInflowSize:e.length>0?r/e.length:0,avgOutflowSize:o.length>0?i/o.length:0,firstTxDate:a.length>0?a[0].date:new Date,lastTxDate:a.length>0?a[a.length-1].date:new Date,topCounterparties:c,peakActivityHour:l,activityScore:h}},Ze=(t,n,e="daily")=>{const o=new Map,a=r=>{if(e==="daily")return r.toISOString().split("T")[0];if(e==="weekly"){const i=new Date(r),s=i.getDay(),c=i.getDate()-s;return new Date(i.setDate(c)).toISOString().split("T")[0]}else return`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`};return t.forEach(r=>{const i=a(r.date),s=o.get(i)||{inflow:0,outflow:0,inflowCount:0,outflowCount:0};r.to===n?(s.inflow+=r.amount,s.inflowCount+=1):r.from===n&&(s.outflow+=r.amount,s.outflowCount+=1),o.set(i,s)}),Array.from(o.entries()).map(([r,i])=>({date:r,inflow:i.inflow,outflow:i.outflow,netFlow:i.inflow-i.outflow,inflowCount:i.inflowCount,outflowCount:i.outflowCount})).sort((r,i)=>r.date.localeCompare(i.date))},me=()=>{const t=_.useCallback(async n=>{var r;const e=n.target,o=(r=e==null?void 0:e.closest)==null?void 0:r.call(e,".copyable");if(!o)return;const a=o.dataset.copy;if(a)try{await navigator.clipboard.writeText(a),o.classList.add("copied"),setTimeout(()=>{o.classList.remove("copied")},1500)}catch(i){console.error("Failed to copy:",i)}},[]);_.useEffect(()=>(document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}),[t])},M=g.jsx("div",{className:"flex items-center justify-center w-full h-full min-h-[100px]",children:g.jsx(J,{className:"w-6 h-6 text-white/50 animate-spin"})}),he=A(()=>k(()=>import("./components/fileupload-ZCVGXnrx.js"),__vite__mapDeps([0,1,2]),import.meta.url),{fallback:M}),fe=A(()=>k(()=>import("./components/summarystats-x00y4ZEX.js"),__vite__mapDeps([3,1]),import.meta.url),{fallback:M}),pe=A(()=>k(()=>import("./components/chartssection-CPZAYBNR.js"),__vite__mapDeps([4,1]),import.meta.url),{fallback:M}),ge=A(()=>k(()=>import("./components/transactiontable-CTGP1dwp.js"),__vite__mapDeps([5,1]),import.meta.url),{fallback:M}),we=A(()=>k(()=>import("./components/moneyflow-BgTnNw7G.js"),__vite__mapDeps([6,1]),import.meta.url),{fallback:M}),ye=A(()=>k(()=>import("./components/unifiedgraph-BQqJQMAc.js"),__vite__mapDeps([7,1,5]),import.meta.url),{fallback:M}),xe=A(()=>k(()=>import("./components/forensicsdashboard-DL47B_5k.js"),__vite__mapDeps([8,1]),import.meta.url),{fallback:M}),be=A(()=>k(()=>import("./components/pathfinder-CK4y3YSD.js"),__vite__mapDeps([9,1]),import.meta.url),{fallback:M}),Se=A(()=>k(()=>import("./components/timelinetracer-QpXQU-0a.js"),__vite__mapDeps([10,1]),import.meta.url),{fallback:M});A(()=>k(()=>import("./components/taintchart-CVy2QCuo.js"),__vite__mapDeps([11,1,12,13]),import.meta.url),{fallback:M});const ve=A(()=>k(()=>import("./components/walletanalysis-BhhFyVVL.js"),__vite__mapDeps([14,1]),import.meta.url),{fallback:M}),Ce=A(()=>k(()=>import("./components/index-v6NW1_nW.js"),__vite__mapDeps([15,1]),import.meta.url),{fallback:M}),Te=()=>{me();const[t,n]=_.useState([]),[e,o]=_.useState("overview"),[a,r]=_.useState(new Set(["overview"])),i=l=>{n(l),o("overview"),r(new Set(["overview"]))};_.useEffect(()=>{t.length>0&&r(l=>{const u=new Set(l);return u.add(e),u})},[e,t]);const s=_.useMemo(()=>ce(t),[t]),c=_.useMemo(()=>le(t),[t]),d=[{id:"overview",label:"Dashboard",icon:X},{id:"arkham",label:"Arkham Tracer",icon:Y},{id:"money-flow",label:"Money Flow Analysis",icon:B},{id:"transactions",label:"Transactions",icon:Q},{id:"wallet-analysis",label:"Wallet Analysis",icon:Z},{id:"interactive",label:"Interactive Graph",icon:ee},{id:"path-finder",label:"Path Finder",icon:te},{id:"timeline",label:"Timeline Tracer",icon:oe},{id:"forensics",label:"Forensics Suite",icon:se}];return g.jsxs("div",{className:"min-h-screen bg-slate-950 text-slate-100 font-sans flex flex-col",children:[g.jsxs("header",{className:"border-b border-slate-800 bg-slate-950/80 backdrop-blur",children:[g.jsxs("div",{className:"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center shadow-lg shadow-indigo-500/20",children:g.jsx(B,{className:"w-5 h-5 text-white"})}),g.jsx("span",{className:"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400",children:"CryptoFlow"})]}),t.length>0&&g.jsx("button",{onClick:()=>n([]),className:"text-xs font-medium text-slate-400 hover:text-white transition-colors border border-slate-800 px-3 py-1.5 rounded bg-slate-900",children:"Reset Data"})]}),t.length>0&&g.jsx("div",{className:"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 mt-2 overflow-x-auto",children:g.jsx("nav",{className:"flex space-x-1 border-b border-slate-800/50 pb-0","aria-label":"Tabs",children:d.map(l=>{const u=e===l.id;return g.jsxs("button",{onClick:()=>o(l.id),className:`
                      flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap
                      ${u?"border-indigo-500 text-indigo-400":"border-transparent text-slate-400 hover:text-slate-200 hover:border-slate-700"}
                    `,children:[g.jsx(l.icon,{className:`w-4 h-4 ${u?"text-indigo-400":"text-slate-500"}`}),l.label]},l.id)})})})]}),g.jsx("main",{className:`flex-1 max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 w-full ${e==="interactive"?"py-4":"py-8"}`,children:t.length===0?g.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[80vh]",children:[g.jsxs("div",{className:"text-center mb-8",children:[g.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 via-purple-400 to-emerald-400",children:"Visualize Money Flow"}),g.jsx("p",{className:"text-slate-400 max-w-lg mx-auto text-lg",children:"Upload your transaction ledger to instantly generate interactive flow graphs, volume analytics, and wallet statistics."})]}),g.jsx(he,{onDataLoaded:i})]}):g.jsxs("div",{className:"animate-fade-in h-full relative",children:[g.jsx("div",{style:{display:e==="overview"?"block":"none"},children:g.jsxs("div",{className:"space-y-8",children:[g.jsx(fe,{summary:s}),g.jsx(pe,{dailyData:c})]})}),g.jsx("div",{style:{display:e==="interactive"?"block":"none"},className:"h-full",children:a.has("interactive")&&g.jsx(ye,{transactions:t,initialAddress:s.topAddress})}),g.jsx("div",{style:{display:e==="money-flow"?"block":"none"},className:"h-full",children:a.has("money-flow")&&g.jsx(we,{transactions:t})}),g.jsx("div",{style:{display:e==="forensics"?"block":"none"},className:"h-full",children:a.has("forensics")&&g.jsx(xe,{transactions:t})}),g.jsx("div",{style:{display:e==="path-finder"?"block":"none"},className:"h-full",children:a.has("path-finder")&&g.jsx(be,{transactions:t})}),g.jsx("div",{style:{display:e==="timeline"?"block":"none"},className:"h-full",children:a.has("timeline")&&g.jsx(Se,{transactions:t})}),g.jsx("div",{style:{display:e==="wallet-analysis"?"block":"none"},className:"h-full",children:a.has("wallet-analysis")&&g.jsx(ve,{transactions:t})}),g.jsx("div",{style:{display:e==="transactions"?"block":"none"},className:"h-full",children:a.has("transactions")&&g.jsx(ge,{transactions:t})}),g.jsx("div",{style:{display:e==="arkham"?"block":"none"},className:"h-full",children:a.has("arkham")&&g.jsx(Ce,{transactions:t})})]})}),g.jsx("footer",{className:"border-t border-slate-900 mt-auto py-8 text-center",children:g.jsx("p",{className:"text-slate-600 text-sm",children:"CryptoFlow Analytics • Local processing only"})})]})},q=document.getElementById("root");if(!q)throw new Error("Could not find root element to mount to");const _e=ne.createRoot(q);_e.render(g.jsx(re.StrictMode,{children:g.jsx(Te,{})}));const et=(()=>{const t=[],n=new Date,e=["Binance_Hot_Wallet","Coinbase_Prime","OKX_Reserves","Kraken_Deposit","Huobi_Global"],o=["Uniswap_V3_USDT_ETH","Curve_3pool","Aave_Lending_Pool","Stargate_Bridge_USDT"],a=["Wintermute_Trading","Jump_Crypto","GSR_Markets"],r="Tornado_Cash_Router",i=Array.from({length:20},(d,l)=>`0xWhale_${l.toString().padStart(2,"0")}`),s=Array.from({length:1e3},(d,l)=>`0x${Math.floor(Math.random()*1e5).toString(16).padStart(4,"0")}`),c=(d,l,u,m)=>{const p=new Date(n);p.setHours(p.getHours()-m),p.setMinutes(p.getMinutes()+Math.floor(Math.random()*60)),t.push({id:`tx_${Math.random().toString(36).substr(2,9)}`,date:p,from:d,to:l,amount:parseFloat(u.toFixed(2)),currency:"USDT",type:"transfer"})};for(let d=0;d<2e3;d++){const l=e[Math.floor(Math.random()*e.length)],u=s[Math.floor(Math.random()*s.length)],m=Math.random()>.4,p=Math.random()*5e3+100,h=Math.floor(Math.random()*24*90);m?c(u,l,p,h):c(l,u,p*.9,h)}for(let d=0;d<200;d++){const l=i[Math.floor(Math.random()*i.length)],u=e[Math.floor(Math.random()*e.length)],m=Math.random()*5e5+5e4,p=Math.floor(Math.random()*24*90);Math.random()>.5?c(l,u,m,p):c(u,l,m,p)}for(let d=0;d<100;d++){const l=a[Math.floor(Math.random()*a.length)],u=e[Math.floor(Math.random()*e.length)],m=o[Math.floor(Math.random()*o.length)],p=Math.random()*1e5+1e4,h=Math.floor(Math.random()*24*30);c(l,u,p,h+4),c(u,m,p*.99,h+3),c(m,l,p*1.01,h+2)}for(let d=0;d<50;d++){const l=s[Math.floor(Math.random()*100)],u=`0xMule_${Math.random().toString(16).substr(2,4)}`,m=`0xMule_${Math.random().toString(16).substr(2,4)}`,p=e[0],h=2e4,f=Math.floor(Math.random()*24*10);c(l,u,h,f+5),c(u,m,h*.98,f+4),c(m,r,h*.96,f+3),c(r,p,h*.9,f+1)}for(let d=0;d<300;d++){const l=s[Math.floor(Math.random()*s.length)],u="Stargate_Bridge_USDT",m=Math.random()*2e3,p=Math.floor(Math.random()*24*60);c(l,u,m,p)}return t.sort((d,l)=>l.date.getTime()-d.date.getTime())})(),Ae="cryptoflow_cache",ke=1,S="wallet_transactions";function E(){return new Promise((t,n)=>{const e=indexedDB.open(Ae,ke);e.onerror=()=>n(e.error),e.onsuccess=()=>t(e.result),e.onupgradeneeded=o=>{const a=o.target.result;if(!a.objectStoreNames.contains(S)){const r=a.createObjectStore(S,{keyPath:["address","chain","tokenContract"]});r.createIndex("address","address",{unique:!1}),r.createIndex("chain","chain",{unique:!1}),r.createIndex("timestamp","timestamp",{unique:!1})}}})}function I(t,n,e){return[t.toLowerCase(),n,e||"all"]}async function Me(t,n,e=null){try{const r=(await E()).transaction(S,"readonly").objectStore(S),i=I(t,n,e),s=r.get(i);return new Promise(c=>{s.onsuccess=()=>{const d=s.result;c(d?d.transactions:null)},s.onerror=()=>c(null)})}catch{return null}}async function De(t,n,e,o){try{const r=(await E()).transaction(S,"readwrite"),i=r.objectStore(S),s={address:t.toLowerCase(),chain:n,tokenContract:e||"all",transactions:o,timestamp:Date.now()};return i.put(s),new Promise((c,d)=>{r.oncomplete=()=>c(),r.onerror=()=>d(r.error)})}catch(a){console.error("Failed to cache transactions:",a)}}async function tt(t,n){try{const o=(await E()).transaction(S,"readwrite"),a=o.objectStore(S),i=a.index("address").getAll(t.toLowerCase());let s=0;return new Promise(c=>{i.onsuccess=()=>{const d=i.result;for(const l of d)if(!n||l.chain===n){const u=I(l.address,l.chain,l.tokenContract);a.delete(u),s++}o.oncomplete=()=>c(s)},i.onerror=()=>c(0)})}catch{return 0}}async function ot(){try{const n=(await E()).transaction(S,"readwrite");return n.objectStore(S).clear(),new Promise((o,a)=>{n.oncomplete=()=>o(),n.onerror=()=>a(n.error)})}catch(t){console.error("Failed to clear cache:",t)}}async function st(){try{const o=(await E()).transaction(S,"readonly").objectStore(S).getAll();return new Promise(a=>{o.onsuccess=()=>{const r=o.result,i=JSON.stringify(r).length,s=i>1024*1024?`${(i/(1024*1024)).toFixed(2)} MB`:`${(i/1024).toFixed(2)} KB`;a({totalEntries:r.length,totalSize:s,entries:r.map(c=>({address:c.address,chain:c.chain,tokenContract:c.tokenContract||"all",txCount:c.transactions.length,cachedAt:new Date(c.timestamp)}))})},o.onerror=()=>a({totalEntries:0,totalSize:"0 KB",entries:[]})})}catch{return{totalEntries:0,totalSize:"0 KB",entries:[]}}}async function nt(t){try{const e=(await E()).transaction(S,"readwrite"),o=e.objectStore(S);let a=0;for(const r of t){const i=I(r.address,r.chain,r.tokenContract);o.delete(i),a++}return new Promise(r=>{e.oncomplete=()=>r(a),e.onerror=()=>r(0)})}catch{return 0}}async function rt(){try{const o=(await E()).transaction(S,"readonly").objectStore(S).getAll();return new Promise((a,r)=>{o.onsuccess=()=>{const i=o.result;K(i,"cryptoflow_cache"),a()},o.onerror=()=>r(o.error)})}catch(t){throw console.error("Failed to export cache:",t),t}}async function at(t){try{const o=(await E()).transaction(S,"readonly").objectStore(S),a=[];for(const r of t){const i=I(r.address,r.chain,r.tokenContract),s=o.get(i);await new Promise(c=>{s.onsuccess=()=>{s.result&&a.push(s.result),c()},s.onerror=()=>c()})}K(a,`cryptoflow_cache_selected_${a.length}`)}catch(n){throw console.error("Failed to export selected cache:",n),n}}function K(t,n){const e={version:1,exportedAt:new Date().toISOString(),totalEntries:t.length,entries:t},o=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(o),r=document.createElement("a");r.href=a,r.download=`${n}_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)}async function it(t){return new Promise((n,e)=>{const o=new FileReader;o.onload=async a=>{var r;try{const i=(r=a.target)==null?void 0:r.result,s=JSON.parse(i);if(!s.entries||!Array.isArray(s.entries))throw new Error("Invalid cache file format: missing entries array");const d=(await E()).transaction(S,"readwrite"),l=d.objectStore(S);let u=0,m=0,p=0;for(const h of s.entries)try{if(!h.address||!h.chain||!h.transactions){m++;continue}const f={address:h.address.toLowerCase(),chain:h.chain,tokenContract:h.tokenContract||"all",transactions:h.transactions,timestamp:h.timestamp||Date.now()};l.put(f),u++}catch{p++}d.oncomplete=()=>n({imported:u,skipped:m,errors:p}),d.onerror=()=>e(d.error)}catch(i){e(i)}},o.onerror=()=>e(o.error),o.readAsText(t)})}const Ee="https://deep-index.moralis.io/api/v2.2",je={bsc:"0x38",eth:"0x1",polygon:"0x89",arbitrum:"0xa4b1",base:"0x2105",optimism:"0xa"},O={bsc:{name:"BNB Smart Chain",symbol:"BSC",chainId:56,explorerUrl:"https://bscscan.com",usdtContract:"0x55d398326f99059fF775485246999027B3197955"},eth:{name:"Ethereum",symbol:"ETH",chainId:1,explorerUrl:"https://etherscan.io",usdtContract:"0xdAC17F958D2ee523a2206206994597C13D831ec7"},polygon:{name:"Polygon",symbol:"MATIC",chainId:137,explorerUrl:"https://polygonscan.com",usdtContract:"0xc2132D05D31c914a87C6611C10748AEb04B58e8F"},arbitrum:{name:"Arbitrum One",symbol:"ARB",chainId:42161,explorerUrl:"https://arbiscan.io",usdtContract:"0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9"},base:{name:"Base",symbol:"BASE",chainId:8453,explorerUrl:"https://basescan.org",usdtContract:void 0},optimism:{name:"Optimism",symbol:"OP",chainId:10,explorerUrl:"https://optimistic.etherscan.io",usdtContract:"0x94b008aA00579c1307B0EF2c499aD98a8ce58e58"}};class ct{constructor(){this._isPaused=!1,this._isStopped=!1,this._pausePromise=null,this._pauseResolve=null}get isPaused(){return this._isPaused}get isStopped(){return this._isStopped}pause(){!this._isPaused&&!this._isStopped&&(this._isPaused=!0,this._pausePromise=new Promise(n=>{this._pauseResolve=n}))}resume(){this._isPaused&&(this._isPaused=!1,this._pauseResolve&&(this._pauseResolve(),this._pauseResolve=null,this._pausePromise=null))}stop(){this._isStopped=!0,this.resume()}reset(){this._isPaused=!1,this._isStopped=!1,this._pausePromise=null,this._pauseResolve=null}async waitIfPaused(){this._pausePromise&&await this._pausePromise}}class Pe{constructor(n){this.queue=[],this.processing=!1,this.lastCall=0,this.minInterval=1e3/n}async schedule(n){return new Promise((e,o)=>{this.queue.push(async()=>{try{const a=await n();e(a)}catch(a){o(a)}}),this.process()})}async process(){if(!this.processing){for(this.processing=!0;this.queue.length>0;){const e=Date.now()-this.lastCall;e<this.minInterval&&await new Promise(a=>setTimeout(a,this.minInterval-e)),this.lastCall=Date.now();const o=this.queue.shift();o&&await o()}this.processing=!1}}}const Le=new Pe(5),$=new Set;function Re(t){return t.split(/[\n,;]/).map(n=>n.trim()).filter(n=>n.length>0)}const Ie=10,Fe=1e3;async function $e(t,n,e,o,a,r,i){const s=je[e];if(!s)throw new Error(`Chain ${e} not supported by Moralis`);const c=(i==null?void 0:i.maxPages)??Ie,d=(i==null?void 0:i.maxTransactions)??Fe,l=[];let u=null,m=0;do{const p=new URLSearchParams({chain:s,order:"ASC",limit:"100"});if(o&&p.set("contract_addresses",o),a){const y=new Date(a).toISOString();p.set("from_date",y)}if(r){const y=new Date(r).toISOString();p.set("to_date",y)}u&&p.set("cursor",u);const h=`${Ee}/${t}/erc20/transfers?${p}`,f=await fetch(h,{headers:{"X-API-Key":n,Accept:"application/json"}});if(!f.ok){const y=await f.text();throw(f.status===429||f.status===401)&&($.add(n),console.warn(`API key ${n.slice(0,8)}... marked as failed (status ${f.status})`)),new Error(`Moralis API error: ${f.status} - ${y}`)}const w=await f.json(),v=w.result||[],x=v.map(y=>({hash:y.transaction_hash,from:y.from_address,to:y.to_address,value:y.value,tokenDecimal:y.token_decimals||"18",tokenSymbol:y.token_symbol||"UNKNOWN",timeStamp:(new Date(y.block_timestamp).getTime()/1e3).toString(),blockNumber:y.block_number,contractAddress:y.address}));if(l.push(...x),m++,u=w.cursor||null,(m>1||u)&&console.log(`[${t.slice(0,8)}...] Page ${m}: ${v.length} transfers (total: ${l.length})${u?", more available":", done"}`),m>=c){console.log(`[${t.slice(0,8)}...] Reached max pages limit (${c})`);break}if(l.length>=d){console.log(`[${t.slice(0,8)}...] Reached max transactions limit (${d})`),l.length=d;break}u&&await new Promise(y=>setTimeout(y,100))}while(u);return l}async function W(t,n,e="bsc",o,a,r,i){if(!O[e])throw new Error(`Unknown chain: ${e}`);const c=Re(n);if(c.length===0)throw new Error("Moralis API key required. Get a free key at: https://moralis.com");const d=c.filter(m=>!$.has(m)),l=d.length>0?d:c;d.length===0&&(console.log("All keys previously failed, resetting failed keys list..."),$.clear());let u=null;for(const m of l)try{return console.log(`Trying API key ${m.slice(0,8)}... (${l.indexOf(m)+1}/${l.length})`),await $e(t,m,e,o,a,r,i)}catch(p){u=p,console.warn(`API key ${m.slice(0,8)}... failed:`,p.message)}throw new Error(`All ${l.length} API keys failed. Last error: ${u==null?void 0:u.message}`)}async function Oe(t,n,e="bsc",o,a,r){const i=O[e];return W(t,n,e,i.usdtContract,o,a,r)}function V(t,n="bsc"){const e=parseInt(t.tokenDecimal)||18,o=parseFloat(t.value)/Math.pow(10,e);return{id:t.hash,date:new Date(parseInt(t.timeStamp)*1e3),from:t.from.toLowerCase(),to:t.to.toLowerCase(),amount:o,currency:t.tokenSymbol||"USDT",type:"transfer"}}async function H(t,n,e="bsc",o=!0,a=!0,r,i,s){const c=O[e],d=o&&c.usdtContract||null;if(a&&!r&&!i){const l=await Me(t,e,d);if(l)return l.map(u=>V(u,e))}return Le.schedule(async()=>{const l=o?await Oe(t,n,e,r,i,s):await W(t,n,e,void 0,r,i,s);return a&&l.length>=0&&!r&&!i&&await De(t,e,d,l),l.map(u=>V(u,e))})}async function lt(t,n,e={}){const{chain:o="bsc",usdtOnly:a=!0,useCache:r=!0,controller:i,onProgress:s,startLayer:c=1,fromDate:d,toDate:l,maxPages:u,maxTransactions:m}=e,p={maxPages:u,maxTransactions:m},h=[...new Set(t.map(b=>b.toLowerCase().trim()))],f=[],w=new Map,v=new Map;let x=0,y=0,C=!1;w.set(c,h),h.forEach(b=>v.set(b,c));for(const b of h){if(i!=null&&i.isStopped){C=!0;break}if(i!=null&&i.isPaused&&(s==null||s({address:b,layer:c,status:"paused",transactions:[]}),await i.waitIfPaused()),i!=null&&i.isStopped){C=!0;break}const T={address:b,layer:c,status:"loading",transactions:[]};s==null||s(T);try{const j=await H(b,n,o,a,r,d,l,p);f.push(...j),x++,T.status="success",T.transactions=j,s==null||s(T)}catch(j){y++,T.status="error",T.error=j.message,s==null||s(T)}}return{totalAddresses:h.length,successCount:x,errorCount:y,allTransactions:f,layerMap:w,addressToLayer:v,wasStopped:C}}async function ut(t,n,e={}){const{chain:o="bsc",usdtOnly:a=!0,useCache:r=!0,controller:i,maxLayers:s=3,onProgress:c,onLayerComplete:d,fromDate:l,toDate:u,maxPages:m,maxTransactions:p}=e,h={maxPages:m,maxTransactions:p},f=[],w=new Map,v=new Map,x=new Set;let y=0,C=0,b=!1,T=1,j=t.map(P=>P.toLowerCase().trim());for(;T<=s&&j.length>0;){if(i!=null&&i.isStopped){b=!0;break}const P=j.filter(D=>!x.has(D));if(P.length===0)break;w.set(T,P),P.forEach(D=>{v.set(D,T),x.add(D)});const N=new Set;for(const D of P){if(i!=null&&i.isStopped){b=!0;break}if(i!=null&&i.isPaused&&(c==null||c({address:D,layer:T,status:"paused",transactions:[]}),await i.waitIfPaused()),i!=null&&i.isStopped){b=!0;break}const L={address:D,layer:T,status:"loading",transactions:[]};c==null||c(L);try{const R=await H(D,n,o,a,r,l,u,h);f.push(...R),y++,R.filter(F=>F.from.toLowerCase()===D).forEach(F=>{const U=F.to.toLowerCase();x.has(U)||N.add(U)}),L.status="success",L.transactions=R,c==null||c(L)}catch(R){C++,L.status="error",L.error=R.message,c==null||c(L)}}if(b)break;d==null||d(T,P),T++,j=Array.from(N)}return{totalAddresses:x.size,successCount:y,errorCount:C,allTransactions:f,layerMap:w,addressToLayer:v,wasStopped:b}}function Ne(t){return/^0x[a-fA-F0-9]{40}$/.test(t)}function dt(t){const n=t.split(/[\n,;]/).map(e=>e.trim().toLowerCase()).filter(e=>e.length>0).filter(Ne);return[...new Set(n)]}function mt(t,n){const e=new Set(n.map(r=>r.toLowerCase())),o=new Map,a=t.filter(r=>e.has(r.from.toLowerCase()));for(const r of a){const i=r.to.toLowerCase();if(e.has(i))continue;o.has(i)||o.set(i,{address:i,layer:2,totalReceived:0,totalSent:0,netFlow:0,incomingTxCount:0,outgoingTxCount:0,sourceAddresses:new Set,destinationAddresses:new Set});const s=o.get(i);s.totalReceived+=r.amount,s.incomingTxCount++,s.sourceAddresses.add(r.from.toLowerCase()),s.netFlow=s.totalReceived-s.totalSent}return Array.from(o.values()).sort((r,i)=>i.totalReceived-r.totalReceived)}function ht(t,n="flow_analysis.csv"){const e=["Address","Layer","Total Received","Total Sent","Net Flow","Incoming TX Count","Outgoing TX Count","Source Count","Destination Count"],o=t.map(c=>[c.address,c.layer.toString(),c.totalReceived.toFixed(6),c.totalSent.toFixed(6),c.netFlow.toFixed(6),c.incomingTxCount.toString(),c.outgoingTxCount.toString(),c.sourceAddresses.size.toString(),c.destinationAddresses.size.toString()]),a=[e,...o].map(c=>c.join(",")).join(`
`),r=new Blob([a],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(r),s=document.createElement("a");return s.setAttribute("href",i),s.setAttribute("download",n),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),a}const ft=(t,n=6,e=4)=>t.length<=n+e?t:`${t.slice(0,n)}...${t.slice(-e)}`,pt=t=>t>=1e6?`$${(t/1e6).toFixed(1)}M`:t>=1e3?`$${(t/1e3).toFixed(1)}K`:`$${t.toFixed(0)}`,gt=t=>{const e=new Date().getTime()-t.getTime(),o=Math.floor(e/1e3),a=Math.floor(o/60),r=Math.floor(a/60),i=Math.floor(r/24),s=Math.floor(i/7),c=Math.floor(i/30),d=Math.floor(i/365);return d>0?`${d}y ago`:c>0?`${c}mo ago`:s>0?`${s}w ago`:i>0?`${i}d ago`:r>0?`${r}h ago`:a>0?`${a}m ago`:"just now"},wt=()=>{const[t,n]=_.useState(!1),e=_.useRef(null),o=_.useRef(new Map);return _.useEffect(()=>{try{e.current=new Worker(new URL(""+new URL("forensics.worker-CDTmhihb.js",import.meta.url).href,import.meta.url),{type:"module"}),n(!0),e.current.onmessage=r=>{const{type:i,requestId:s,data:c,error:d}=r.data,l=o.current.get(s);l&&(i==="SUCCESS"?l(c):i==="ERROR"&&(console.error("Forensics Worker error:",d),l(null)),o.current.delete(s))},e.current.onerror=r=>{console.error("Worker error:",r)}}catch(r){console.error("Failed to initialize forensics worker:",r)}return()=>{var r;(r=e.current)==null||r.terminate(),o.current.clear()}},[]),{executeTask:_.useCallback(r=>new Promise(i=>{if(!e.current){console.warn("Worker not initialized, returning null"),i(null);return}const s=`req_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;o.current.set(s,i);const c={...r,requestId:s};e.current.postMessage(c)}),[]),isReady:t}};class G{constructor(n=50,e=30){this.cache=new Map,this.currentSize=0,this.maxSize=n*1024*1024,this.ttl=e*60*1e3}set(n,e){const o=JSON.stringify(e).length*2;for(;this.currentSize+o>this.maxSize&&this.cache.size>0;)this.evictOldest();const a=this.cache.get(n);a&&(this.currentSize-=a.size),this.cache.set(n,{data:e,timestamp:Date.now(),size:o}),this.currentSize+=o}get(n){const e=this.cache.get(n);return e?Date.now()-e.timestamp>this.ttl?(this.delete(n),null):e.data:null}delete(n){const e=this.cache.get(n);e&&(this.currentSize-=e.size,this.cache.delete(n))}evictOldest(){let n=null,e=1/0;this.cache.forEach((o,a)=>{o.timestamp<e&&(e=o.timestamp,n=a)}),n&&this.delete(n)}clear(){this.cache.clear(),this.currentSize=0}stats(){return{entries:this.cache.size,sizeMB:(this.currentSize/(1024*1024)).toFixed(2),maxSizeMB:(this.maxSize/(1024*1024)).toFixed(2),utilization:(this.currentSize/this.maxSize*100).toFixed(1)+"%"}}has(n){return this.cache.has(n)&&this.get(n)!==null}}const yt=new G(20,30),xt=new G(10,30),bt=(t,n)=>{const e=Object.keys(n).sort().map(o=>`${o}:${JSON.stringify(n[o])}`).join("|");return`${t}_${e}`},Ue=t=>{const n=["Path","Hops","Total Amount","Suspicion Score","Start Date","End Date","Avg Delay (hours)"],e=t.map(o=>[o.addresses.join(" → "),o.hops.toString(),o.totalAmount.toFixed(2),o.suspicionScore.toFixed(1),o.startDate.toISOString(),o.endDate.toISOString(),(o.avgDelay/36e5).toFixed(2)]);return[n.join(","),...e.map(o=>o.map(a=>`"${a}"`).join(","))].join(`
`)},Be=t=>JSON.stringify({generatedAt:new Date().toISOString(),version:"1.0",application:"CryptoFlow Analytics",...t},null,2),ze=t=>{const n=["Type","Severity","Score","Description","Affected Addresses Count","Transactions Count"],e=t.map(o=>[o.type,o.severity,o.score.toString(),o.description,o.affectedAddresses.length.toString(),o.transactions.length.toString()]);return[n.join(","),...e.map(o=>o.map(a=>`"${a}"`).join(","))].join(`
`)},Ve=t=>{const n=["Source","Target","Total Tainted","Taint Percentage","Path","Path Amount","Path Percentage"],e=t.paths.map(o=>[t.sourceAddress,t.targetAddress,t.totalTainted.toFixed(2),t.taintPercentage.toFixed(2),o.path.join(" → "),o.amount.toFixed(2),o.percentage.toFixed(2)]);return[n.join(","),...e.map(o=>o.map(a=>`"${a}"`).join(","))].join(`
`)},qe=t=>{const n=["Cluster ID","Address Count","Common Behavior","Total Volume","Transaction Count","Confidence Score"],e=t.map(o=>[o.clusterId,o.addresses.length.toString(),o.commonBehavior,o.totalVolume.toFixed(2),o.transactionCount.toString(),o.confidenceScore.toFixed(2)]);return[n.join(","),...e.map(o=>o.map(a=>`"${a}"`).join(","))].join(`
`)},Ke=(t,n)=>{const e=URL.createObjectURL(t),o=document.createElement("a");o.href=e,o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(e)},St=(t,n,e)=>{let o,a,r;switch(n){case"paths":o=Ue(t),a="csv",r="text/csv";break;case"patterns":o=ze(t),a="csv",r="text/csv";break;case"taint":o=Ve(t),a="csv",r="text/csv";break;case"clusters":o=qe(t),a="csv",r="text/csv";break;case"json":default:o=Be(t),a="json",r="application/json";break}const i=new Blob([o],{type:`${r};charset=utf-8`}),s=`cryptoflow-${n}-${new Date().toISOString().split("T")[0]}.${a}`;Ke(i,e||s)};export{at as A,nt as B,O as C,Ge as D,M as L,et as S,k as _,ft as a,yt as b,Ve as c,Xe as d,St as e,pt as f,bt as g,Ye as h,Qe as i,Ze as j,Je as k,gt as l,dt as m,ct as n,lt as o,xt as p,mt as q,Re as r,ut as s,ht as t,wt as u,st as v,tt as w,rt as x,it as y,ot as z};
