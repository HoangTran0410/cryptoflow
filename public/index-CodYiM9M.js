const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./components/fileupload-CtEYOG87.js","./vendor-DWEmHMvc.js","./components/walletscanner-BATBTbJl.js","./components/summarystats-ChMES5pR.js","./components/chartssection-DGYBQ-rz.js","./components/transactiontable-Di6tvRna.js","./components/moneyflow-BZnvFxDP.js","./components/unifiedgraph-fK58Hztv.js","./components/forensicsdashboard-C2E5mD_S.js","./components/pathfinder-BvL0jVLQ.js","./components/timelinetracer-Bh5sm7rv.js","./components/taintchart-BuLUvWbA.js","./components/loadingspinner--iLA6-au.js","./components/exportbutton-DLkyn2ZO.js","./components/walletanalysis-Dg9Uw-K3.js","./components/index-ClvR4x5K.js"])))=>i.map(i=>d[i]);
import{r as S,j as w,H as z,n as T,ax as R,ay as B,w as q,ah as W,I as H,N as K,Q as G,g as J,o as X,az as Y,ae as Q}from"./vendor-DWEmHMvc.js";import"./index-CodYiM9M.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(a){if(a.ep)return;a.ep=!0;const c=t(a);fetch(a.href,c)}})();function $t(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}const Z="modulepreload",tt=function(s,n){return new URL(s,n).href},I={},_=function(n,t,o){let a=Promise.resolve();if(t&&t.length>0){let r=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};const e=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),d=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));a=r(t.map(l=>{if(l=tt(l,o),l in I)return;I[l]=!0;const u=l.endsWith(".css"),m=u?'[rel="stylesheet"]':"";if(!!o)for(let h=e.length-1;h>=0;h--){const g=e[h];if(g.href===l&&(!u||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${m}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":Z,u||(f.as="script"),f.crossOrigin="",f.href=l,d&&f.setAttribute("nonce",d),document.head.appendChild(f),u)return new Promise((h,g)=>{f.addEventListener("load",h),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function c(r){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=r,window.dispatchEvent(e),!e.defaultPrevented)throw r}return a.then(r=>{for(const e of r||[])e.status==="rejected"&&c(e.reason);return n().catch(c)})},et=s=>{if(s.length===0)return{totalVolume:0,transactionCount:0,uniqueAddresses:0,avgTransactionValue:0,maxTransactionValue:0,startDate:new Date,endDate:new Date,topAddress:""};const n=s.reduce((e,i)=>e+i.amount,0),t=new Map;s.forEach(e=>{t.set(e.from,(t.get(e.from)||0)+e.amount),t.set(e.to,(t.get(e.to)||0)+e.amount)});let o="",a=0;t.forEach((e,i)=>{e>a&&(a=e,o=i)});const c=Math.max(...s.map(e=>e.amount)),r=s.map(e=>e.date.getTime());return{totalVolume:n,transactionCount:s.length,uniqueAddresses:t.size,avgTransactionValue:n/s.length,maxTransactionValue:c,startDate:new Date(Math.min(...r)),endDate:new Date(Math.max(...r)),topAddress:o}},st=s=>{const n=new Map;return s.forEach(t=>{const o=t.date.toISOString().split("T")[0],a=n.get(o)||{volume:0,count:0};n.set(o,{volume:a.volume+t.amount,count:a.count+1})}),Array.from(n.entries()).map(([t,o])=>({date:t,...o})).sort((t,o)=>t.date.localeCompare(o.date))},ot=s=>{if(s.length===0)return 0;let n=0;const o=s.filter(e=>{const i=e.amount;return i>=1e3&&i%1e3===0}).length/s.length;n+=o*30;const a=[...s].sort((e,i)=>e.date.getTime()-i.date.getTime());let c=0;for(let e=1;e<a.length;e++)a[e].date.getTime()-a[e-1].date.getTime()<300*1e3&&c++;a.length>1&&(n+=c/(a.length-1)*30);const r=Math.min(s.length*3,20);if(n+=r,s.length>1){const e=s.map(m=>m.amount),i=e.reduce((m,p)=>m+p,0)/e.length,d=e.reduce((m,p)=>m+Math.pow(p-i,2),0)/e.length,l=Math.sqrt(d),u=i>0?l/i:1;u<.1?n+=20:u<.3&&(n+=10)}return Math.min(n,100)},nt=(s,n,t,o=10,a=100)=>{const c=performance.now(),r=new Map;s.forEach(u=>{r.has(u.from)||r.set(u.from,[]),r.get(u.from).push({tx:u,to:u.to})});const e=[],i=(u,m,p,f,h)=>{if(e.length>=a||h>o)return;if(u===t){const y=f.reduce((v,b)=>v+b.amount,0),x=f.map(v=>v.date.getTime()).sort((v,b)=>v-b),M=x.slice(1).map((v,b)=>v-x[b]);e.push({addresses:[...p,u],transactions:[...f],totalAmount:y,hops:f.length,startDate:new Date(x[0]),endDate:new Date(x[x.length-1]),avgDelay:M.length>0?M.reduce((v,b)=>v+b,0)/M.length:0,suspicionScore:ot(f)});return}const g=r.get(u)||[];for(const{tx:y,to:x}of g)m.has(x)||(m.add(x),i(x,m,[...p,u],[...f,y],h+1),m.delete(x))};i(n,new Set([n]),[],[],0);const l=e.length>0?e.reduce((u,m)=>m.hops<u.hops?m:u,e[0]):null;return{source:n,target:t,paths:e,shortestPath:l,statistics:{totalPathsFound:e.length,avgPathLength:e.length>0?e.reduce((u,m)=>u+m.hops,0)/e.length:0,executionTime:performance.now()-c}}},Ut=(s,n,t,o=10)=>{const a=nt(s,n,t,o,1e3),c=[];let r=0;a.paths.forEach(l=>{if(l.transactions.length===0)return;let u=l.transactions[0].amount;for(let m=0;m<l.transactions.length;m++){const p=l.transactions[m],f=p.from,g=s.filter(y=>y.from===f&&y.date>=p.date&&y.date<=new Date(p.date.getTime()+1440*60*1e3)).reduce((y,x)=>y+x.amount,0);g>0&&(u*=p.amount/g)}u>.01&&(c.push({path:l.addresses,amount:u,percentage:u/l.transactions[0].amount*100}),r+=u)});const i=s.filter(l=>l.to===t).reduce((l,u)=>l+u.amount,0),d=i>0?r/i*100:0;return{sourceAddress:n,targetAddress:t,totalTainted:r,taintPercentage:d,paths:c.sort((l,u)=>u.amount-l.amount).slice(0,20),hops:o}},Vt=(s,n)=>{const t=[],o=s.filter(e=>e.from===n||e.to===n).sort((e,i)=>e.date.getTime()-i.date.getTime());if(o.length===0)return t;const a=new Map;o.forEach(e=>{const i=e.date.toISOString().split("T")[0];a.has(i)||a.set(i,[]),a.get(i).push(e)}),a.forEach((e,i)=>{const d=e.reduce((f,h)=>f+h.amount,0);let l="transfer",u=.5;e.length>10&&(l="spike",u=Math.min(e.length/50,1));const m=e.filter(f=>f.to===n),p=e.filter(f=>f.from===n);m.length>5&&p.length<=1?(l="aggregation",u=.8):m.length<=1&&p.length>5&&(l="split",u=.8),t.push({timestamp:new Date(i),type:l,address:n,amount:d,relatedAddresses:Array.from(new Set(e.map(f=>f.from===n?f.to:f.from))),significance:u})});const c=t.sort((e,i)=>e.timestamp.getTime()-i.timestamp.getTime()),r=[];for(let e=1;e<c.length;e++){const i=c[e].timestamp.getTime()-c[e-1].timestamp.getTime(),d=i/(1e3*60*60*24);d>7&&r.push({timestamp:new Date(c[e-1].timestamp.getTime()+i/2),type:"dormant",address:n,amount:0,relatedAddresses:[],significance:Math.min(d/30,1)})}return[...t,...r].sort((e,i)=>e.timestamp.getTime()-i.timestamp.getTime())},zt=s=>{const n=new Set;return s.forEach(t=>{n.add(t.from),n.add(t.to)}),Array.from(n).sort()},Bt=(s,n)=>{const t=s.filter(h=>h.to===n),o=s.filter(h=>h.from===n),a=[...t,...o].sort((h,g)=>h.date.getTime()-g.date.getTime()),c=t.reduce((h,g)=>h+g.amount,0),r=o.reduce((h,g)=>h+g.amount,0),e=new Map;t.forEach(h=>{const g=e.get(h.from)||{volume:0,count:0};e.set(h.from,{volume:g.volume+h.amount,count:g.count+1})}),o.forEach(h=>{const g=e.get(h.to)||{volume:0,count:0};e.set(h.to,{volume:g.volume+h.amount,count:g.count+1})});const i=Array.from(e.entries()).map(([h,g])=>({address:h,volume:g.volume,count:g.count})).sort((h,g)=>g.volume-h.volume).slice(0,10),d=new Map;a.forEach(h=>{const g=h.date.getHours();d.set(g,(d.get(g)||0)+1)});let l=0,u=0;d.forEach((h,g)=>{h>u&&(u=h,l=g)});const m=a.length,p=c+r,f=Math.min(100,m*2+Math.log10(p+1)*10);return{address:n,totalInflow:c,totalOutflow:r,netBalance:c-r,inflowCount:t.length,outflowCount:o.length,totalTxCount:m,avgInflowSize:t.length>0?c/t.length:0,avgOutflowSize:o.length>0?r/o.length:0,firstTxDate:a.length>0?a[0].date:new Date,lastTxDate:a.length>0?a[a.length-1].date:new Date,topCounterparties:i,peakActivityHour:l,activityScore:f}},qt=(s,n,t="daily")=>{const o=new Map,a=c=>{if(t==="daily")return c.toISOString().split("T")[0];if(t==="weekly"){const r=new Date(c),e=r.getDay(),i=r.getDate()-e;return new Date(r.setDate(i)).toISOString().split("T")[0]}else return`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`};return s.forEach(c=>{const r=a(c.date),e=o.get(r)||{inflow:0,outflow:0,inflowCount:0,outflowCount:0};c.to===n?(e.inflow+=c.amount,e.inflowCount+=1):c.from===n&&(e.outflow+=c.amount,e.outflowCount+=1),o.set(r,e)}),Array.from(o.entries()).map(([c,r])=>({date:c,inflow:r.inflow,outflow:r.outflow,netFlow:r.inflow-r.outflow,inflowCount:r.inflowCount,outflowCount:r.outflowCount})).sort((c,r)=>c.date.localeCompare(r.date))},at=()=>{const s=S.useCallback(async n=>{var c;const t=n.target,o=(c=t==null?void 0:t.closest)==null?void 0:c.call(t,".copyable");if(!o)return;const a=o.dataset.copy;if(a)try{await navigator.clipboard.writeText(a),o.classList.add("copied"),setTimeout(()=>{o.classList.remove("copied")},1500)}catch(r){console.error("Failed to copy:",r)}},[]);S.useEffect(()=>(document.addEventListener("click",s),()=>{document.removeEventListener("click",s)}),[s])},A=w.jsx("div",{className:"flex items-center justify-center w-full h-full min-h-[100px]",children:w.jsx(z,{className:"w-6 h-6 text-white/50 animate-spin"})}),rt=T(()=>_(()=>import("./components/fileupload-CtEYOG87.js"),__vite__mapDeps([0,1,2]),import.meta.url),{fallback:A}),it=T(()=>_(()=>import("./components/summarystats-ChMES5pR.js"),__vite__mapDeps([3,1]),import.meta.url),{fallback:A}),ct=T(()=>_(()=>import("./components/chartssection-DGYBQ-rz.js"),__vite__mapDeps([4,1]),import.meta.url),{fallback:A}),lt=T(()=>_(()=>import("./components/transactiontable-Di6tvRna.js"),__vite__mapDeps([5,1]),import.meta.url),{fallback:A}),ut=T(()=>_(()=>import("./components/moneyflow-BZnvFxDP.js"),__vite__mapDeps([6,1]),import.meta.url),{fallback:A}),dt=T(()=>_(()=>import("./components/unifiedgraph-fK58Hztv.js"),__vite__mapDeps([7,1,5]),import.meta.url),{fallback:A}),mt=T(()=>_(()=>import("./components/forensicsdashboard-C2E5mD_S.js"),__vite__mapDeps([8,1]),import.meta.url),{fallback:A}),ht=T(()=>_(()=>import("./components/pathfinder-BvL0jVLQ.js"),__vite__mapDeps([9,1]),import.meta.url),{fallback:A}),ft=T(()=>_(()=>import("./components/timelinetracer-Bh5sm7rv.js"),__vite__mapDeps([10,1]),import.meta.url),{fallback:A});T(()=>_(()=>import("./components/taintchart-BuLUvWbA.js"),__vite__mapDeps([11,1,12,13]),import.meta.url),{fallback:A});const pt=T(()=>_(()=>import("./components/walletanalysis-Dg9Uw-K3.js"),__vite__mapDeps([14,1]),import.meta.url),{fallback:A}),gt=T(()=>_(()=>import("./components/index-ClvR4x5K.js"),__vite__mapDeps([15,1]),import.meta.url),{fallback:A}),wt=()=>{at();const[s,n]=S.useState([]),[t,o]=S.useState("overview"),[a,c]=S.useState(new Set(["overview"])),r=l=>{n(l),o("overview"),c(new Set(["overview"]))};S.useEffect(()=>{s.length>0&&c(l=>{const u=new Set(l);return u.add(t),u})},[t,s]);const e=S.useMemo(()=>et(s),[s]),i=S.useMemo(()=>st(s),[s]),d=[{id:"overview",label:"Dashboard",icon:B},{id:"arkham",label:"Arkham Tracer",icon:q},{id:"money-flow",label:"Money Flow Analysis",icon:R},{id:"transactions",label:"Transactions",icon:W},{id:"wallet-analysis",label:"Wallet Analysis",icon:H},{id:"interactive",label:"Interactive Graph",icon:K},{id:"path-finder",label:"Path Finder",icon:G},{id:"timeline",label:"Timeline Tracer",icon:J},{id:"forensics",label:"Forensics Suite",icon:X}];return w.jsxs("div",{className:"min-h-screen bg-slate-950 text-slate-100 font-sans flex flex-col",children:[w.jsxs("header",{className:"border-b border-slate-800 bg-slate-950/80 backdrop-blur",children:[w.jsxs("div",{className:"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center shadow-lg shadow-indigo-500/20",children:w.jsx(R,{className:"w-5 h-5 text-white"})}),w.jsx("span",{className:"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400",children:"CryptoFlow"})]}),s.length>0&&w.jsx("button",{onClick:()=>n([]),className:"text-xs font-medium text-slate-400 hover:text-white transition-colors border border-slate-800 px-3 py-1.5 rounded bg-slate-900",children:"Reset Data"})]}),s.length>0&&w.jsx("div",{className:"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 mt-2 overflow-x-auto",children:w.jsx("nav",{className:"flex space-x-1 border-b border-slate-800/50 pb-0","aria-label":"Tabs",children:d.map(l=>{const u=t===l.id;return w.jsxs("button",{onClick:()=>o(l.id),className:`
                      flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap
                      ${u?"border-indigo-500 text-indigo-400":"border-transparent text-slate-400 hover:text-slate-200 hover:border-slate-700"}
                    `,children:[w.jsx(l.icon,{className:`w-4 h-4 ${u?"text-indigo-400":"text-slate-500"}`}),l.label]},l.id)})})})]}),w.jsx("main",{className:`flex-1 max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 w-full ${t==="interactive"?"py-4":"py-8"}`,children:s.length===0?w.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[80vh]",children:[w.jsxs("div",{className:"text-center mb-8",children:[w.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 via-purple-400 to-emerald-400",children:"Visualize Money Flow"}),w.jsx("p",{className:"text-slate-400 max-w-lg mx-auto text-lg",children:"Upload your transaction ledger to instantly generate interactive flow graphs, volume analytics, and wallet statistics."})]}),w.jsx(rt,{onDataLoaded:r})]}):w.jsxs("div",{className:"animate-fade-in h-full relative",children:[w.jsx("div",{style:{display:t==="overview"?"block":"none"},children:w.jsxs("div",{className:"space-y-8",children:[w.jsx(it,{summary:e}),w.jsx(ct,{dailyData:i})]})}),w.jsx("div",{style:{display:t==="interactive"?"block":"none"},className:"h-full",children:a.has("interactive")&&w.jsx(dt,{transactions:s,initialAddress:e.topAddress})}),w.jsx("div",{style:{display:t==="money-flow"?"block":"none"},className:"h-full",children:a.has("money-flow")&&w.jsx(ut,{transactions:s})}),w.jsx("div",{style:{display:t==="forensics"?"block":"none"},className:"h-full",children:a.has("forensics")&&w.jsx(mt,{transactions:s})}),w.jsx("div",{style:{display:t==="path-finder"?"block":"none"},className:"h-full",children:a.has("path-finder")&&w.jsx(ht,{transactions:s})}),w.jsx("div",{style:{display:t==="timeline"?"block":"none"},className:"h-full",children:a.has("timeline")&&w.jsx(ft,{transactions:s})}),w.jsx("div",{style:{display:t==="wallet-analysis"?"block":"none"},className:"h-full",children:a.has("wallet-analysis")&&w.jsx(pt,{transactions:s})}),w.jsx("div",{style:{display:t==="transactions"?"block":"none"},className:"h-full",children:a.has("transactions")&&w.jsx(lt,{transactions:s})}),w.jsx("div",{style:{display:t==="arkham"?"block":"none"},className:"h-full",children:a.has("arkham")&&w.jsx(gt,{transactions:s})})]})}),w.jsx("footer",{className:"border-t border-slate-900 mt-auto py-8 text-center",children:w.jsx("p",{className:"text-slate-600 text-sm",children:"CryptoFlow Analytics • Local processing only"})})]})},O=document.getElementById("root");if(!O)throw new Error("Could not find root element to mount to");const yt=Y.createRoot(O);yt.render(w.jsx(Q.StrictMode,{children:w.jsx(wt,{})}));const Wt=(()=>{const s=[],n=new Date,t=["Binance_Hot_Wallet","Coinbase_Prime","OKX_Reserves","Kraken_Deposit","Huobi_Global"],o=["Uniswap_V3_USDT_ETH","Curve_3pool","Aave_Lending_Pool","Stargate_Bridge_USDT"],a=["Wintermute_Trading","Jump_Crypto","GSR_Markets"],c="Tornado_Cash_Router",r=Array.from({length:20},(d,l)=>`0xWhale_${l.toString().padStart(2,"0")}`),e=Array.from({length:1e3},(d,l)=>`0x${Math.floor(Math.random()*1e5).toString(16).padStart(4,"0")}`),i=(d,l,u,m)=>{const p=new Date(n);p.setHours(p.getHours()-m),p.setMinutes(p.getMinutes()+Math.floor(Math.random()*60)),s.push({id:`tx_${Math.random().toString(36).substr(2,9)}`,date:p,from:d,to:l,amount:parseFloat(u.toFixed(2)),currency:"USDT",type:"transfer"})};for(let d=0;d<2e3;d++){const l=t[Math.floor(Math.random()*t.length)],u=e[Math.floor(Math.random()*e.length)],m=Math.random()>.4,p=Math.random()*5e3+100,f=Math.floor(Math.random()*24*90);m?i(u,l,p,f):i(l,u,p*.9,f)}for(let d=0;d<200;d++){const l=r[Math.floor(Math.random()*r.length)],u=t[Math.floor(Math.random()*t.length)],m=Math.random()*5e5+5e4,p=Math.floor(Math.random()*24*90);Math.random()>.5?i(l,u,m,p):i(u,l,m,p)}for(let d=0;d<100;d++){const l=a[Math.floor(Math.random()*a.length)],u=t[Math.floor(Math.random()*t.length)],m=o[Math.floor(Math.random()*o.length)],p=Math.random()*1e5+1e4,f=Math.floor(Math.random()*24*30);i(l,u,p,f+4),i(u,m,p*.99,f+3),i(m,l,p*1.01,f+2)}for(let d=0;d<50;d++){const l=e[Math.floor(Math.random()*100)],u=`0xMule_${Math.random().toString(16).substr(2,4)}`,m=`0xMule_${Math.random().toString(16).substr(2,4)}`,p=t[0],f=2e4,h=Math.floor(Math.random()*24*10);i(l,u,f,h+5),i(u,m,f*.98,h+4),i(m,c,f*.96,h+3),i(c,p,f*.9,h+1)}for(let d=0;d<300;d++){const l=e[Math.floor(Math.random()*e.length)],u="Stargate_Bridge_USDT",m=Math.random()*2e3,p=Math.floor(Math.random()*24*60);i(l,u,m,p)}return s.sort((d,l)=>l.date.getTime()-d.date.getTime())})(),xt="cryptoflow_cache",bt=1,C="wallet_transactions",St=1440*60*1e3;function E(){return new Promise((s,n)=>{const t=indexedDB.open(xt,bt);t.onerror=()=>n(t.error),t.onsuccess=()=>s(t.result),t.onupgradeneeded=o=>{const a=o.target.result;if(!a.objectStoreNames.contains(C)){const c=a.createObjectStore(C,{keyPath:["address","chain","tokenContract"]});c.createIndex("address","address",{unique:!1}),c.createIndex("chain","chain",{unique:!1}),c.createIndex("timestamp","timestamp",{unique:!1})}}})}function N(s,n,t){return[s.toLowerCase(),n,t||"all"]}async function vt(s,n,t=null){try{const c=(await E()).transaction(C,"readonly").objectStore(C),r=N(s,n,t),e=c.get(r);return new Promise(i=>{e.onsuccess=()=>{const d=e.result;d&&d.expiresAt>Date.now()?i(d.transactions):i(null)},e.onerror=()=>i(null)})}catch{return null}}async function Ct(s,n,t,o,a=St){try{const r=(await E()).transaction(C,"readwrite"),e=r.objectStore(C),i=Date.now(),d={address:s.toLowerCase(),chain:n,tokenContract:t||"all",transactions:o,timestamp:i,expiresAt:i+a};return e.put(d),new Promise((l,u)=>{r.oncomplete=()=>l(),r.onerror=()=>u(r.error)})}catch(c){console.error("Failed to cache transactions:",c)}}async function Ht(s,n){try{const o=(await E()).transaction(C,"readwrite"),a=o.objectStore(C),r=a.index("address").getAll(s.toLowerCase());let e=0;return new Promise(i=>{r.onsuccess=()=>{const d=r.result;for(const l of d)if(!n||l.chain===n){const u=N(l.address,l.chain,l.tokenContract);a.delete(u),e++}o.oncomplete=()=>i(e)},r.onerror=()=>i(0)})}catch{return 0}}async function Kt(){try{const n=(await E()).transaction(C,"readwrite");return n.objectStore(C).clear(),new Promise((o,a)=>{n.oncomplete=()=>o(),n.onerror=()=>a(n.error)})}catch(s){console.error("Failed to clear cache:",s)}}async function Gt(){try{const o=(await E()).transaction(C,"readonly").objectStore(C).getAll();return new Promise(a=>{o.onsuccess=()=>{const c=o.result,r=Date.now(),e=c.filter(l=>l.expiresAt>r),i=JSON.stringify(c).length,d=i>1024*1024?`${(i/(1024*1024)).toFixed(2)} MB`:`${(i/1024).toFixed(2)} KB`;a({totalEntries:e.length,totalSize:d,entries:e.map(l=>({address:l.address,chain:l.chain,txCount:l.transactions.length,cachedAt:new Date(l.timestamp),expiresAt:new Date(l.expiresAt)}))})},o.onerror=()=>a({totalEntries:0,totalSize:"0 KB",entries:[]})})}catch{return{totalEntries:0,totalSize:"0 KB",entries:[]}}}const Tt="https://deep-index.moralis.io/api/v2.2",_t={bsc:"0x38",eth:"0x1",polygon:"0x89",arbitrum:"0xa4b1",base:"0x2105",optimism:"0xa"},L={bsc:{name:"BNB Smart Chain",symbol:"BSC",chainId:56,explorerUrl:"https://bscscan.com",usdtContract:"0x55d398326f99059fF775485246999027B3197955"},eth:{name:"Ethereum",symbol:"ETH",chainId:1,explorerUrl:"https://etherscan.io",usdtContract:"0xdAC17F958D2ee523a2206206994597C13D831ec7"},polygon:{name:"Polygon",symbol:"MATIC",chainId:137,explorerUrl:"https://polygonscan.com",usdtContract:"0xc2132D05D31c914a87C6611C10748AEb04B58e8F"},arbitrum:{name:"Arbitrum One",symbol:"ARB",chainId:42161,explorerUrl:"https://arbiscan.io",usdtContract:"0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9"},base:{name:"Base",symbol:"BASE",chainId:8453,explorerUrl:"https://basescan.org",usdtContract:void 0},optimism:{name:"Optimism",symbol:"OP",chainId:10,explorerUrl:"https://optimistic.etherscan.io",usdtContract:"0x94b008aA00579c1307B0EF2c499aD98a8ce58e58"}};class Jt{constructor(){this._isPaused=!1,this._isStopped=!1,this._pausePromise=null,this._pauseResolve=null}get isPaused(){return this._isPaused}get isStopped(){return this._isStopped}pause(){!this._isPaused&&!this._isStopped&&(this._isPaused=!0,this._pausePromise=new Promise(n=>{this._pauseResolve=n}))}resume(){this._isPaused&&(this._isPaused=!1,this._pauseResolve&&(this._pauseResolve(),this._pauseResolve=null,this._pausePromise=null))}stop(){this._isStopped=!0,this.resume()}reset(){this._isPaused=!1,this._isStopped=!1,this._pausePromise=null,this._pauseResolve=null}async waitIfPaused(){this._pausePromise&&await this._pausePromise}}class At{constructor(n){this.queue=[],this.processing=!1,this.lastCall=0,this.minInterval=1e3/n}async schedule(n){return new Promise((t,o)=>{this.queue.push(async()=>{try{const a=await n();t(a)}catch(a){o(a)}}),this.process()})}async process(){if(!this.processing){for(this.processing=!0;this.queue.length>0;){const t=Date.now()-this.lastCall;t<this.minInterval&&await new Promise(a=>setTimeout(a,this.minInterval-t)),this.lastCall=Date.now();const o=this.queue.shift();o&&await o()}this.processing=!1}}}const Mt=new At(5);async function Dt(s,n,t,o){const a=_t[t];if(!a)throw new Error(`Chain ${t} not supported by Moralis`);const c=new URLSearchParams({chain:a,order:"ASC"});o&&c.set("contract_addresses",o);const r=`${Tt}/${s}/erc20/transfers?${c}`,e=await fetch(r,{headers:{"X-API-Key":n,Accept:"application/json"}});if(!e.ok){const l=await e.text();throw new Error(`Moralis API error: ${e.status} - ${l}`)}return((await e.json()).result||[]).map(l=>({hash:l.transaction_hash,from:l.from_address,to:l.to_address,value:l.value,tokenDecimal:l.token_decimals||"18",tokenSymbol:l.token_symbol||"UNKNOWN",timeStamp:(new Date(l.block_timestamp).getTime()/1e3).toString(),blockNumber:l.block_number,contractAddress:l.address}))}async function $(s,n,t="bsc",o){if(!L[t])throw new Error(`Unknown chain: ${t}`);if(!n)throw new Error("Moralis API key required. Get a free key at: https://moralis.com");return await Dt(s,n,t,o)}async function kt(s,n,t="bsc"){const o=L[t];return $(s,n,t,o.usdtContract)}function F(s,n="bsc"){const t=parseInt(s.tokenDecimal)||18,o=parseFloat(s.value)/Math.pow(10,t);return{id:s.hash,date:new Date(parseInt(s.timeStamp)*1e3),from:s.from.toLowerCase(),to:s.to.toLowerCase(),amount:o,currency:s.tokenSymbol||"USDT",type:"transfer"}}async function U(s,n,t="bsc",o=!0,a=!0){const c=L[t],r=o&&c.usdtContract||null;if(a){const e=await vt(s,t,r);if(e)return e.map(i=>F(i,t))}return Mt.schedule(async()=>{const e=o?await kt(s,n,t):await $(s,n,t);return a&&e.length>=0&&await Ct(s,t,r,e),e.map(i=>F(i,t))})}async function Xt(s,n,t={}){const{chain:o="bsc",usdtOnly:a=!0,useCache:c=!0,controller:r,onProgress:e,startLayer:i=1}=t,d=s.map(g=>g.toLowerCase().trim()),l=[],u=new Map,m=new Map;let p=0,f=0,h=!1;u.set(i,d),d.forEach(g=>m.set(g,i));for(const g of d){if(r!=null&&r.isStopped){h=!0;break}if(r!=null&&r.isPaused&&(e==null||e({address:g,layer:i,status:"paused",transactions:[]}),await r.waitIfPaused()),r!=null&&r.isStopped){h=!0;break}const y={address:g,layer:i,status:"loading",transactions:[]};e==null||e(y);try{const x=await U(g,n,o,a,c);l.push(...x),p++,y.status="success",y.transactions=x,e==null||e(y)}catch(x){f++,y.status="error",y.error=x.message,e==null||e(y)}}return{totalAddresses:d.length,successCount:p,errorCount:f,allTransactions:l,layerMap:u,addressToLayer:m,wasStopped:h}}async function Yt(s,n,t={}){const{chain:o="bsc",usdtOnly:a=!0,useCache:c=!0,controller:r,maxLayers:e=3,onProgress:i,onLayerComplete:d}=t,l=[],u=new Map,m=new Map,p=new Set;let f=0,h=0,g=!1,y=1,x=s.map(M=>M.toLowerCase().trim());for(;y<=e&&x.length>0;){if(r!=null&&r.isStopped){g=!0;break}const M=x.filter(b=>!p.has(b));if(M.length===0)break;u.set(y,M),M.forEach(b=>{m.set(b,y),p.add(b)});const v=new Set;for(const b of M){if(r!=null&&r.isStopped){g=!0;break}if(r!=null&&r.isPaused&&(i==null||i({address:b,layer:y,status:"paused",transactions:[]}),await r.waitIfPaused()),r!=null&&r.isStopped){g=!0;break}const D={address:b,layer:y,status:"loading",transactions:[]};i==null||i(D);try{const k=await U(b,n,o,a,c);l.push(...k),f++,k.filter(j=>j.from.toLowerCase()===b).forEach(j=>{const P=j.to.toLowerCase();p.has(P)||v.add(P)}),D.status="success",D.transactions=k,i==null||i(D)}catch(k){h++,D.status="error",D.error=k.message,i==null||i(D)}}if(g)break;d==null||d(y,M),y++,x=Array.from(v)}return{totalAddresses:p.size,successCount:f,errorCount:h,allTransactions:l,layerMap:u,addressToLayer:m,wasStopped:g}}function Et(s){return/^0x[a-fA-F0-9]{40}$/.test(s)}function Qt(s){const n=s.split(/[\n,;]/).map(t=>t.trim().toLowerCase()).filter(t=>t.length>0).filter(Et);return[...new Set(n)]}function Zt(s,n){const t=new Set(n.map(c=>c.toLowerCase())),o=new Map,a=s.filter(c=>t.has(c.from.toLowerCase()));for(const c of a){const r=c.to.toLowerCase();if(t.has(r))continue;o.has(r)||o.set(r,{address:r,layer:2,totalReceived:0,totalSent:0,netFlow:0,incomingTxCount:0,outgoingTxCount:0,sourceAddresses:new Set,destinationAddresses:new Set});const e=o.get(r);e.totalReceived+=c.amount,e.incomingTxCount++,e.sourceAddresses.add(c.from.toLowerCase()),e.netFlow=e.totalReceived-e.totalSent}return Array.from(o.values()).sort((c,r)=>r.totalReceived-c.totalReceived)}function te(s,n="flow_analysis.csv"){const t=["Address","Layer","Total Received","Total Sent","Net Flow","Incoming TX Count","Outgoing TX Count","Source Count","Destination Count"],o=s.map(i=>[i.address,i.layer.toString(),i.totalReceived.toFixed(6),i.totalSent.toFixed(6),i.netFlow.toFixed(6),i.incomingTxCount.toString(),i.outgoingTxCount.toString(),i.sourceAddresses.size.toString(),i.destinationAddresses.size.toString()]),a=[t,...o].map(i=>i.join(",")).join(`
`),c=new Blob([a],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(c),e=document.createElement("a");return e.setAttribute("href",r),e.setAttribute("download",n),e.style.visibility="hidden",document.body.appendChild(e),e.click(),document.body.removeChild(e),a}const ee=(s,n=6,t=4)=>s.length<=n+t?s:`${s.slice(0,n)}...${s.slice(-t)}`,se=s=>s>=1e6?`$${(s/1e6).toFixed(1)}M`:s>=1e3?`$${(s/1e3).toFixed(1)}K`:`$${s.toFixed(0)}`,oe=s=>{const t=new Date().getTime()-s.getTime(),o=Math.floor(t/1e3),a=Math.floor(o/60),c=Math.floor(a/60),r=Math.floor(c/24),e=Math.floor(r/7),i=Math.floor(r/30),d=Math.floor(r/365);return d>0?`${d}y ago`:i>0?`${i}mo ago`:e>0?`${e}w ago`:r>0?`${r}d ago`:c>0?`${c}h ago`:a>0?`${a}m ago`:"just now"},ne=()=>{const[s,n]=S.useState(!1),t=S.useRef(null),o=S.useRef(new Map);return S.useEffect(()=>{try{t.current=new Worker(new URL(""+new URL("forensics.worker-CDTmhihb.js",import.meta.url).href,import.meta.url),{type:"module"}),n(!0),t.current.onmessage=c=>{const{type:r,requestId:e,data:i,error:d}=c.data,l=o.current.get(e);l&&(r==="SUCCESS"?l(i):r==="ERROR"&&(console.error("Forensics Worker error:",d),l(null)),o.current.delete(e))},t.current.onerror=c=>{console.error("Worker error:",c)}}catch(c){console.error("Failed to initialize forensics worker:",c)}return()=>{var c;(c=t.current)==null||c.terminate(),o.current.clear()}},[]),{executeTask:S.useCallback(c=>new Promise(r=>{if(!t.current){console.warn("Worker not initialized, returning null"),r(null);return}const e=`req_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;o.current.set(e,r);const i={...c,requestId:e};t.current.postMessage(i)}),[]),isReady:s}};class V{constructor(n=50,t=30){this.cache=new Map,this.currentSize=0,this.maxSize=n*1024*1024,this.ttl=t*60*1e3}set(n,t){const o=JSON.stringify(t).length*2;for(;this.currentSize+o>this.maxSize&&this.cache.size>0;)this.evictOldest();const a=this.cache.get(n);a&&(this.currentSize-=a.size),this.cache.set(n,{data:t,timestamp:Date.now(),size:o}),this.currentSize+=o}get(n){const t=this.cache.get(n);return t?Date.now()-t.timestamp>this.ttl?(this.delete(n),null):t.data:null}delete(n){const t=this.cache.get(n);t&&(this.currentSize-=t.size,this.cache.delete(n))}evictOldest(){let n=null,t=1/0;this.cache.forEach((o,a)=>{o.timestamp<t&&(t=o.timestamp,n=a)}),n&&this.delete(n)}clear(){this.cache.clear(),this.currentSize=0}stats(){return{entries:this.cache.size,sizeMB:(this.currentSize/(1024*1024)).toFixed(2),maxSizeMB:(this.maxSize/(1024*1024)).toFixed(2),utilization:(this.currentSize/this.maxSize*100).toFixed(1)+"%"}}has(n){return this.cache.has(n)&&this.get(n)!==null}}const ae=new V(20,30),re=new V(10,30),ie=(s,n)=>{const t=Object.keys(n).sort().map(o=>`${o}:${JSON.stringify(n[o])}`).join("|");return`${s}_${t}`},jt=s=>{const n=["Path","Hops","Total Amount","Suspicion Score","Start Date","End Date","Avg Delay (hours)"],t=s.map(o=>[o.addresses.join(" → "),o.hops.toString(),o.totalAmount.toFixed(2),o.suspicionScore.toFixed(1),o.startDate.toISOString(),o.endDate.toISOString(),(o.avgDelay/36e5).toFixed(2)]);return[n.join(","),...t.map(o=>o.map(a=>`"${a}"`).join(","))].join(`
`)},Lt=s=>JSON.stringify({generatedAt:new Date().toISOString(),version:"1.0",application:"CryptoFlow Analytics",...s},null,2),Pt=s=>{const n=["Type","Severity","Score","Description","Affected Addresses Count","Transactions Count"],t=s.map(o=>[o.type,o.severity,o.score.toString(),o.description,o.affectedAddresses.length.toString(),o.transactions.length.toString()]);return[n.join(","),...t.map(o=>o.map(a=>`"${a}"`).join(","))].join(`
`)},Rt=s=>{const n=["Source","Target","Total Tainted","Taint Percentage","Path","Path Amount","Path Percentage"],t=s.paths.map(o=>[s.sourceAddress,s.targetAddress,s.totalTainted.toFixed(2),s.taintPercentage.toFixed(2),o.path.join(" → "),o.amount.toFixed(2),o.percentage.toFixed(2)]);return[n.join(","),...t.map(o=>o.map(a=>`"${a}"`).join(","))].join(`
`)},It=s=>{const n=["Cluster ID","Address Count","Common Behavior","Total Volume","Transaction Count","Confidence Score"],t=s.map(o=>[o.clusterId,o.addresses.length.toString(),o.commonBehavior,o.totalVolume.toFixed(2),o.transactionCount.toString(),o.confidenceScore.toFixed(2)]);return[n.join(","),...t.map(o=>o.map(a=>`"${a}"`).join(","))].join(`
`)},Ft=(s,n)=>{const t=URL.createObjectURL(s),o=document.createElement("a");o.href=t,o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(t)},ce=(s,n,t)=>{let o,a,c;switch(n){case"paths":o=jt(s),a="csv",c="text/csv";break;case"patterns":o=Pt(s),a="csv",c="text/csv";break;case"taint":o=Rt(s),a="csv",c="text/csv";break;case"clusters":o=It(s),a="csv",c="text/csv";break;case"json":default:o=Lt(s),a="json",c="application/json";break}const r=new Blob([o],{type:`${c};charset=utf-8`}),e=`cryptoflow-${n}-${new Date().toISOString().split("T")[0]}.${a}`;Ft(r,t||e)};export{L as C,A as L,Wt as S,_,ee as a,ae as b,Rt as c,Vt as d,ce as e,se as f,ie as g,zt as h,Bt as i,qt as j,Ut as k,oe as l,Qt as m,Jt as n,Xt as o,re as p,Zt as q,te as r,Yt as s,Gt as t,ne as u,Ht as v,Kt as w,$t as x};
